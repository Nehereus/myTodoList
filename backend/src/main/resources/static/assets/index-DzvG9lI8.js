(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const te=t=>typeof t,ee="",Zi=te(ee),ro=te(!0),Qi=te(0),oo=te(te),as="type",re="default",lo="Listener",co="add",oe="Has",zs="Ids",xe="Table",vi=xe+"s",ho=xe+zs,As="Row",uo=As+"Count",ao=As+zs,xs="Cell",xi=xs+zs,bs="Value",Li=bs+"s",fo=bs+zs,X=t=>ee+t,go=isFinite,po=(t,e)=>t instanceof e,lt=t=>t==null,at=(t,e,s)=>lt(t)?s?.():e(t),Xi=t=>t==Zi||t==ro,mo=t=>te(t)==Zi,Qs=t=>te(t)==oo,be=t=>Array.isArray(t),Ci=(t,e,s)=>t.slice(e,s),Ot=t=>t.length,yo=(t,e)=>t.test(e),Xs=async(t,e,s)=>{try{return await t()}catch(i){e?.(i)}},wo=(t,e)=>t.includes(e),Ii=(t,e)=>t.every(e),qi=(t,e)=>Ot(t)===Ot(e)&&Ii(t,(s,i)=>e[i]===s),ki=(t,e)=>Ii(t,(s,i)=>i==0||e(t[i-1],s)<=0),nn=(t,e)=>t.sort(e),Wt=(t,e)=>t.forEach(e),Fe=(t,e)=>t.map(e),So=t=>Ot(t)==0,To=(t,e,s)=>t.reduce(e,s),Rs=(t,...e)=>t.push(...e),vo=t=>t.shift(),Ve=t=>{const e=te(t);return Xi(e)||e==Qi&&go(t)?e:void 0},Ai=(t,e,s,i,n)=>lt(n)?t.delCell(e,s,i,!0):t.setCell(e,s,i,n),bi=(t,e,s)=>lt(s)?t.delValue(e):t.setValue(e,s),yn=t=>e=>To(Sn(e),(s,i)=>s+t(i),0),wn=t=>t?.size??0,Os=yn(wn),Le=yn(Os),Is=yn(Le),mt=(t,e)=>t?.has(e)??!1,W=t=>lt(t)||wn(t)==0,Sn=t=>[...t?.values()??[]],ze=t=>t.clear(),J=(t,e)=>t?.forEach(e),It=(t,e)=>t?.delete(e),se=Object,Ri=t=>se.getPrototypeOf(t),xo=se.isFrozen,tr=se.entries,Es=t=>!lt(t)&&at(Ri(t),e=>e==se.prototype||lt(Ri(e)),()=>!0),Lo=se.keys,er=se.freeze,Co=(t=[])=>se.fromEntries(t),Pe=(t,e)=>e in t,sr=(t,e)=>(delete t[e],t),ko=(t,e)=>Wt(tr(t),([s,i])=>e(i,s)),Ao=(t,e)=>Fe(tr(t),([s,i])=>e(i,s)),Yt=(t,e)=>Co(Ao(t,(s,i)=>[i,e(s,i)])),bo=t=>Ot(Lo(t)),Pt=t=>Es(t)&&bo(t)==0,Kt=(t,e,s,i=0)=>lt(t)||!Es(t)||!i&&Pt(t)||xo(t)?(s?.(),!1):(ko(t,(n,r)=>{e(n,r)||sr(t,r)}),i?!0:!Pt(t)),_=t=>new Map(t),ce=t=>[...t?.keys()??[]],b=(t,e)=>t?.get(e),bt=(t,e)=>J(t,(s,i)=>e(i,s)),Ro=(t,e)=>Fe([...t?.entries()??[]],([s,i])=>e(i,s)),H=(t,e,s)=>lt(s)?(It(t,e),t):t?.set(e,s),yt=(t,e,s,i)=>(mt(t,e)?i?.(b(t,e)):H(t,e,s()),b(t,e)),le=(t,e,s,i=H)=>(Yt(e,(n,r)=>s(t,r,n)),bt(t,n=>Pe(e,n)?0:i(t,n)),t),kt=(t,e,s,i)=>{const n={};return J(t,(r,l)=>{if(!s?.(r,l)){const h=e?e(r,l):r;i?.(h)||(n[l]=h)}}),n},rn=(t,e,s)=>kt(t,i=>kt(i,e,s),W,Pt),fs=(t,e,s)=>kt(t,i=>rn(i,e,s),W,Pt),Zt=(t,e)=>{const s=_();return J(t,(i,n)=>s.set(n,e?.(i)??i)),s},on=t=>Zt(t,Zt),qs=t=>Zt(t,on),ln=(t,e,s,i,n=0)=>at((s?yt:b)(t,e[n],n>Ot(e)-2?s:_),r=>{if(n>Ot(e)-2)return i?.(r)&&H(t,e[n]),r;const l=ln(r,e,s,i,n+1);return W(r)&&H(t,e[n]),l}),Dt=t=>new Set(be(t)||lt(t)?t:[t]),Rt=(t,e)=>t?.add(e),Eo=(t,e,s,i,n)=>{const r=t.hasRow,l=_(),h=_(),c=_(),u=_(),a=_(),d=_(),S=()=>t,m=()=>ce(l),w=E=>bt(h,E),p=E=>mt(h,E),y=E=>b(l,E),C=E=>b(h,E),x=(E,$)=>H(h,E,$),B=(E,$,...G)=>{const Y=yt(d,E,Dt);return Wt(G,j=>Rt(Y,j)&&$&&t.callListener(j)),G},P=(E,...$)=>at(b(d,E),G=>{Wt(So($)?Sn(G):$,Y=>{t.delListener(Y),It(G,Y)}),W(G)&&H(d,E)}),O=(E,$)=>{H(l,E,$),mt(h,E)||(H(h,E,e()),H(u,E,_()),H(a,E,_()),n(c))},V=(E,$,G,Y,j)=>{O(E,$);const z=_(),Q=_(),st=b(u,E),et=b(a,E),wt=Z=>{const nt=K=>t.getCell($,Z,K),ot=b(st,Z),R=r($,Z)?s(Y(nt,Z)):void 0;if(ot===R||be(ot)&&be(R)&&qi(ot,R)||H(z,Z,[ot,R]),!lt(j)){const K=b(et,Z),Lt=r($,Z)?j(nt,Z):void 0;K!=Lt&&H(Q,Z,Lt)}},ft=Z=>{G(()=>{J(z,([,nt],ot)=>H(st,ot,nt)),J(Q,(nt,ot)=>H(et,ot,nt))},z,Q,st,et,Z),ze(z),ze(Q)};bt(st,wt),t.hasTable($)&&Wt(t.getRowIds($),Z=>{mt(st,Z)||wt(Z)}),ft(!0),P(E),B(E,0,t.addRowListener($,null,(Z,nt,ot)=>wt(ot)),t.addTableListener($,()=>ft()))},L=E=>{H(l,E),H(h,E),H(u,E),H(a,E),P(E),n(c)};return[S,m,w,p,y,C,x,O,V,L,E=>i(E,c),()=>bt(d,L),B,P]},Ei=(t,e)=>mo(t)?s=>s(t):t??(()=>e??ee),Do=(t,e)=>{const s=new WeakMap;return i=>{s.has(i)||s.set(i,t(i));const n=s.get(i);return e?.(n),n}},jo=/^\d+$/,nr=()=>{const t=[];let e=0;return[s=>(s?vo(t):null)??ee+e++,s=>{yo(jo,s)&&Ot(t)<1e3&&Rs(t,s)}]},Bo=(t,e=[ee])=>{const s=[],i=(n,r)=>r==Ot(e)?Rs(s,n):e[r]===null?J(n,l=>i(l,r+1)):Wt([e[r],null],l=>i(b(n,l),r+1));return i(t,0),s},ir=t=>{let e;const[s,i]=nr(),n=_();return[(u,a,d,S=[],m=()=>[])=>{e??=t();const w=s(1);return H(n,w,[u,a,d,S,m]),Rt(ln(a,d??[ee],Dt),w),w},(u,a,...d)=>Wt(Bo(u,a),S=>J(S,m=>b(n,m)[0](e,...a??[],...d))),u=>at(b(n,u),([,a,d])=>(ln(a,d??[ee],void 0,S=>(It(S,u),W(S)?1:0)),H(n,u),i(u),d)),u=>at(b(n,u),([a,,d=[],S,m])=>{const w=(...p)=>{const y=Ot(p);y==Ot(d)?a(e,...p,...m(p)):lt(d[y])?Wt(S[y]?.(...p)??[],C=>w(...p,C)):w(...p,d[y])};w()})]},$o=JSON.stringify,tn=JSON.parse,me=t=>$o(t,(e,s)=>po(s,Map)?se.fromEntries([...s]):s),rr=(t,e)=>(t??0)<(e??0)?-1:1,Mo=Do(t=>{const e=_(),s=_(),[i,n,r]=ir(()=>Y),[l,h,c,u,a,d,S,,m,w,p,y]=Eo(t,_,j=>lt(j)?ee:be(j)?Fe(j,X):X(j),i,n),C=(j,z)=>mt(d(j),z),x=(j,z,Q,st,et,wt=rr)=>{const ft=lt(et)?void 0:([Z],[nt])=>et(Z,nt);return m(j,z,(Z,nt,ot,R,K,Lt)=>{let jt=0;const Nt=Dt(),dt=Dt(),F=d(j);if(J(nt,([I,gt],Tt)=>{const it=Dt(I),ge=Dt(gt);J(it,Ct=>It(ge,Ct)?It(it,Ct):0),J(it,Ct=>{Rt(Nt,Ct),at(b(F,Ct),Ge=>{It(Ge,Tt),W(Ge)&&(H(F,Ct),jt=1)})}),J(ge,Ct=>{Rt(Nt,Ct),mt(F,Ct)||(H(F,Ct,Dt()),jt=1),Rt(b(F,Ct),Tt),lt(st)||Rt(dt,Ct)})}),Z(),W(K)||(Lt?bt(F,I=>Rt(dt,I)):bt(ot,I=>at(b(R,I),gt=>Wt(be(gt)?gt:[gt],Tt=>Rt(dt,Tt)))),J(dt,I=>{const gt=(it,ge)=>wt(b(K,it),b(K,ge),I),Tt=[...b(F,I)];ki(Tt,gt)||(H(F,I,Dt(nn(Tt,gt))),Rt(Nt,I))})),(jt||Lt)&&!lt(ft)){const I=[...F];ki(I,ft)||(S(j,_(nn(I,ft))),jt=1)}jt&&n(e,[j]),J(Nt,I=>n(s,[j,I]))},Ei(Q),at(st,Ei)),Y},B=j=>c((z,Q)=>j(z,st=>O(z,st,Q))),P=(j,z)=>O(j,z,d(j)),O=(j,z,Q)=>{const st=a(j);J(Q,(et,wt)=>z(wt,ft=>J(et,Z=>ft(Z,nt=>t.forEachCell(st,Z,nt)))))},Y={setIndexDefinition:x,delIndexDefinition:j=>(w(j),Y),getStore:l,getIndexIds:h,forEachIndex:B,forEachSlice:P,hasIndex:u,hasSlice:C,getTableId:a,getSliceIds:j=>ce(d(j)),getSliceRowIds:(j,z)=>Sn(b(d(j),z)),addIndexIdsListener:p,addSliceIdsListener:(j,z)=>i(z,e,[j]),addSliceRowIdsListener:(j,z,Q)=>i(Q,s,[j,z]),delListener:j=>(r(j),Y),destroy:y,getListenerStats:()=>({sliceIds:Os(e),sliceRowIds:Le(s)})};return er(Y)}),ds=t=>[t,t],ht=(t,e=Os)=>e(t[0])+e(t[1]),ut=()=>[_(),_()],Di=t=>[...t],gs=([t,e])=>t===e,_e=(t,e,s)=>H(t,e,b(t,e)==-s?void 0:s),or=()=>{let t,e,s=!1,i=!1,n=0,r=[];const l=_(),h=_(),c=_(),u=_(),a=_(),d=_(),S=_(),m=_(),w=_(),p=_(),y=_(),C=_(),x=_(),B=_(),P=Dt(),O=_(),V=_(),L=_(),k=_(),M=ut(),E=ut(),$=ut(),G=ut(),Y=ut(),j=ut(),z=ut(),Q=ut(),st=ut(),et=ut(),wt=ut(),ft=ut(),Z=ut(),nt=ut(),ot=ut(),R=ut(),K=ut(),Lt=ut(),jt=ut(),Nt=ut(),dt=ut(),F=ut(),I=_(),gt=ut(),[Tt,it,ge,Ct]=ir(()=>vt),Ge=o=>Kt(o,f=>Kt(f,Dn)),Ar=o=>Kt(o,Dn),Dn=o=>{if(!Kt(o,(g,T)=>wo([as,re],T)))return!1;const f=o[as];return!Xi(f)&&f!=Qi?!1:(Ve(o[re])!=f&&sr(o,re),!0)},br=be,Rr=o=>Kt(o,jn,Jt),jn=(o,f)=>(!t||mt(y,f)||Jt(f))&&Kt(o,(g,T)=>Ze(f,T,g),()=>Jt(f)),Ze=(o,f,g,T)=>Kt(T?g:Vn(g,o,f),(v,A)=>at(Bn(o,f,A,v),N=>(g[A]=N,!0),()=>!1),()=>Jt(o,f)),Bn=(o,f,g,T)=>t?at(b(b(y,o),g),v=>Ve(T)!=v[as]?Jt(o,f,g,T,v[re]):T,()=>Jt(o,f,g,T)):lt(Ve(T))?Jt(o,f,g,T):T,$n=(o,f)=>Kt(f?o:Er(o),(g,T)=>at(Mn(T,g),v=>(o[T]=v,!0),()=>!1),()=>Be()),Mn=(o,f)=>e?at(b(x,o),g=>Ve(f)!=g[as]?Be(o,f,g[re]):f,()=>Be(o,f)):lt(Ve(f))?Be(o,f):f,Vn=(o,f,g)=>(at(b(C,f),([T,v])=>{J(T,(A,N)=>{Pe(o,N)||(o[N]=A)}),J(v,A=>{Pe(o,A)||Jt(f,g,A)})}),o),Er=o=>(e&&(J(B,(f,g)=>{Pe(o,g)||(o[g]=f)}),J(P,f=>{Pe(o,f)||Be(f)})),o),_n=o=>le(y,o,(f,g,T)=>{const v=_(),A=Dt();le(yt(y,g,_),T,(N,q,tt)=>{H(N,q,tt),at(tt[re],Ft=>H(v,q,Ft),()=>Rt(A,q))}),H(C,g,[v,A])},(f,g)=>{H(y,g),H(C,g)}),Nn=o=>le(x,o,(f,g,T)=>{H(x,g,T),at(T[re],v=>H(B,g,v),()=>Rt(P,g))},(f,g)=>{H(x,g),H(B,g),It(P,g)}),Pn=o=>Pt(o)?ls():rs(o),Dr=([o,f])=>{(Pt(o)?ls:rs)(o),(Pt(f)?cs:os)(f)},zn=o=>le(L,o,(f,g,T)=>Qe(g,T),(f,g)=>Wn(g)),Qe=(o,f)=>le(yt(L,o,()=>(Yn(o,1),H(O,o,nr()),H(V,o,_()),_())),f,(g,T,v)=>je(o,g,T,v),(g,T)=>Jn(o,g,T)),je=(o,f,g,T,v)=>le(yt(f,g,()=>(Gn(o,g,1),_())),T,(A,N,q)=>Ws(o,g,A,N,q),(A,N)=>Un(o,f,g,A,N,v)),Ws=(o,f,g,T,v)=>{mt(g,T)||Zn(o,f,T,1);const A=b(g,T);v!==A&&(Qn(o,f,T,A,v),H(g,T,v))},On=(o,f,g,T,v)=>at(b(f,g),A=>Ws(o,g,A,T,v),()=>je(o,f,g,Vn({[T]:v},o,g))),Fn=o=>Pt(o)?cs():os(o),Hn=o=>le(k,o,(f,g,T)=>Xe(g,T),(f,g)=>Kn(g)),Xe=(o,f)=>{mt(k,o)||Xn(o,1);const g=b(k,o);f!==g&&(In(o,g,f),H(k,o,f))},jr=(o,f)=>{const[g]=b(O,o);let T;do T=g(f);while(mt(b(L,o),T));return T},Ie=o=>b(L,o)??Qe(o,{}),Wn=o=>Qe(o,{}),Jn=(o,f,g)=>{const[,T]=b(O,o);T(g),je(o,f,g,{},!0)},Un=(o,f,g,T,v,A)=>{const N=b(b(C,o)?.[0],v);if(!lt(N)&&!A)return Ws(o,g,T,v,N);const q=tt=>{Qn(o,g,tt,b(T,tt)),Zn(o,g,tt,-1),H(T,tt)};lt(N)?q(v):bt(T,q),W(T)&&(Gn(o,g,-1),W(H(f,g))&&(Yn(o,-1),H(L,o),H(O,o),H(V,o)))},Kn=o=>{const f=b(B,o);if(!lt(f))return Xe(o,f);In(o,b(k,o)),Xn(o,-1),H(k,o)},Yn=(o,f)=>_e(l,o,f),Gn=(o,f,g)=>_e(yt(u,o,_),f,g)&&H(c,o,yt(c,o,()=>0)+g),Zn=(o,f,g,T)=>{const v=b(V,o),A=b(v,g)??0;(A==0&&T==1||A==1&&T==-1)&&_e(yt(h,o,_),g,T),H(v,g,A!=-T?A+T:null),_e(yt(yt(a,o,_),f,_),g,T)},Qn=(o,f,g,T,v)=>{yt(yt(yt(d,o,_),f,_),g,()=>[T,0])[1]=v,r[3]?.(o,f,g,v)},Xn=(o,f)=>_e(S,o,f),In=(o,f,g)=>{yt(m,o,()=>[f,0])[1]=g,r[4]?.(o,g)},Jt=(o,f,g,T,v)=>(Rs(yt(yt(yt(w,o,_),f,_),g,()=>[]),T),v),Be=(o,f,g)=>(Rs(yt(p,o,()=>[]),f),g),qe=(o,f,g)=>at(b(b(b(d,o),f),g),([T,v])=>[!0,T,v],()=>[!1,...ds(es(o,f,g))]),qn=o=>at(b(m,o),([f,g])=>[!0,f,g],()=>[!1,...ds(ss(o))]),ti=o=>!W(w)&&!W(R[o])?J(o?qs(w):w,(f,g)=>J(f,(T,v)=>J(T,(A,N)=>it(R[o],[g,v,N],A)))):0,ei=o=>!W(p)&&!W(K[o])?J(o?Zt(p):p,(f,g)=>it(K[o],[g],f)):0,$e=(o,f,g,T)=>{if(!W(o))return it(f,T,()=>kt(o)),bt(o,(v,A)=>it(g,[...T??[],v],A==1)),1},si=o=>{const f=ns();f!=s&&it(M[o],void 0,f);const g=W(et[o]),T=W(Z[o])&&W(nt[o])&&W(st[o])&&W(wt[o])&&W(j[o])&&W(z[o])&&W(Q[o])&&g&&W($[o])&&W(G[o]),v=W(ot[o])&&W(ft[o])&&W(Y[o])&&W(E[o]);if(!T||!v){const A=o?[Zt(l),on(h),Zt(c),on(u),qs(a),qs(d)]:[l,h,c,u,a,d];if(!T){$e(A[0],$[o],G[o]),J(A[1],(q,tt)=>$e(q,j[o],z[o],[tt])),J(A[2],(q,tt)=>{q!=0&&it(Q[o],[tt],oi(tt))});const N=Dt();J(A[3],(q,tt)=>{$e(q,st[o],wt[o],[tt])&&!g&&(it(et[o],[tt,null]),Rt(N,tt))}),g||J(A[5],(q,tt)=>{if(!mt(N,tt)){const Ft=Dt();J(q,Ut=>J(Ut,([hs,us],Me)=>us!==hs?Rt(Ft,Me):It(Ut,Me))),J(Ft,Ut=>it(et[o],[tt,Ut]))}}),J(A[4],(q,tt)=>J(q,(Ft,Ut)=>$e(Ft,Z[o],nt[o],[tt,Ut])))}if(!v){let N;J(A[5],(q,tt)=>{let Ft;J(q,(Ut,hs)=>{let us;J(Ut,([Me,Ti],io)=>{Ti!==Me&&(it(ot[o],[tt,hs,io],Ti,Me,qe),N=Ft=us=1)}),us&&it(ft[o],[tt,hs],qe)}),Ft&&it(Y[o],[tt],qe)}),N&&it(E[o],void 0,qe)}}},ni=o=>{const f=is();f!=i&&it(Lt[o],void 0,f);const g=W(Nt[o])&&W(dt[o]),T=W(F[o])&&W(jt[o]);if(!g||!T){const v=o?[Zt(S),Zt(m)]:[S,m];if(g||$e(v[0],Nt[o],dt[o]),!T){let A;J(v[1],([N,q],tt)=>{q!==N&&(it(F[o],[tt],q,N,qn),A=1)}),A&&it(jt[o],void 0,qn)}}},ct=(o,...f)=>(Zs(()=>o(...Fe(f,X))),vt),ii=(o,f,g,T,v)=>{let A=ts(o,f,...g);return Tt(()=>{const N=ts(o,f,...g);qi(N,A)||(A=N,T(vt,o,f,...g,A))},et[v?1:0],[o,f],[At])},Br=()=>[Js(),Ks()],Js=()=>fs(L),At=()=>ce(L),$r=o=>rn(b(L,X(o))),ri=o=>ce(b(V,X(o))),oi=o=>wn(b(L,X(o))),pe=o=>ce(b(L,X(o))),ts=(o,f,g,T=0,v)=>Es(o)?ts(o.tableId,o.cellId,o.descending,o.offset,o.limit):Fe(Ci(nn(Ro(b(L,X(o)),(A,N)=>[lt(f)?N:b(A,X(f)),N]),([A],[N])=>rr(A,N)*(g?-1:1)),T,lt(v)?v:T+v),([,A])=>A),Mr=(o,f)=>kt(b(b(L,X(o)),X(f))),Us=(o,f)=>ce(b(b(L,X(o)),X(f))),es=(o,f,g)=>b(b(b(L,X(o)),X(f)),X(g)),Ks=()=>kt(k),Ys=()=>ce(k),ss=o=>b(k,X(o)),ns=()=>!W(L),li=o=>mt(L,X(o)),ci=(o,f)=>mt(b(V,X(o)),X(f)),hi=(o,f)=>mt(b(L,X(o)),X(f)),ui=(o,f,g)=>mt(b(b(L,X(o)),X(f)),X(g)),is=()=>!W(k),ai=o=>mt(k,X(o)),Vr=()=>me(L),_r=()=>me(k),Nr=()=>me([L,k]),Pr=()=>me(y),zr=()=>me(x),Or=()=>me([y,x]),Fr=o=>ct(()=>{const f=Qs(o)?o():o;br(f)&&Dr(f)}),rs=o=>ct(()=>Rr(o)?zn(o):0),Hr=(o,f)=>ct(g=>jn(f,g)?Qe(g,f):0,o),Wr=(o,f,g)=>ct((T,v)=>Ze(T,v,g)?je(T,Ie(T),v,g):0,o,f),Jr=(o,f,g=!0)=>Zs(()=>{let T;return Ze(o,T,f)&&(o=X(o),je(o,Ie(o),T=jr(o,g?1:0),f)),T}),Ur=(o,f,g)=>ct((T,v)=>{if(Ze(T,v,g,1)){const A=Ie(T);Yt(g,(N,q)=>On(T,A,v,q,N))}},o,f),Kr=(o,f,g,T)=>ct((v,A,N)=>at(Bn(v,A,N,Qs(T)?T(es(v,A,N)):T),q=>On(v,Ie(v),A,N,q)),o,f,g),os=o=>ct(()=>$n(o)?Hn(o):0),Yr=o=>ct(()=>$n(o,1)?Yt(o,(f,g)=>Xe(g,f)):0),Gr=(o,f)=>ct(g=>at(Mn(g,Qs(f)?f(ss(g)):f),T=>Xe(g,T)),o),Zr=o=>ct(()=>{Yt(o[0],(f,g)=>lt(f)?pi(g):Yt(f,(T,v)=>lt(T)?mi(g,v):Yt(T,(A,N)=>Ai(vt,g,v,N,A)))),Yt(o[1],(f,g)=>bi(vt,g,f))}),fi=o=>(Xs(()=>Pn(tn(o))),vt),Qr=o=>(Xs(()=>Fn(tn(o))),vt),Xr=o=>ct(()=>Xs(()=>{const[f,g]=tn(o);Pn(f),Fn(g)},()=>fi(o))),di=o=>ct(()=>{if((t=Ge(o))&&(_n(o),!W(L))){const f=Js();ls(),rs(f)}}),gi=o=>ct(()=>{if(e=Ar(o)){const f=Ks();Gs(),cs(),e=!0,Nn(o),os(f)}}),Ir=(o,f)=>ct(()=>{di(o),gi(f)}),ls=()=>ct(()=>zn({})),pi=o=>ct(f=>mt(L,f)?Wn(f):0,o),mi=(o,f)=>ct((g,T)=>at(b(L,g),v=>mt(v,T)?Jn(g,v,T):0),o,f),qr=(o,f,g,T)=>ct((v,A,N)=>at(b(L,v),q=>at(b(q,A),tt=>mt(tt,N)?Un(v,q,A,tt,N,T):0)),o,f,g),cs=()=>ct(()=>Hn({})),to=o=>ct(f=>mt(k,f)?Kn(f):0,o),yi=()=>ct(()=>{_n({}),t=!1}),Gs=()=>ct(()=>{Nn({}),e=!1}),eo=()=>ct(()=>{yi(),Gs()}),Zs=(o,f)=>{if(n!=-1){wi();const g=o();return Si(f),g}},wi=()=>(n!=-1&&n++,n==1&&(r[0]?.(),it(I)),vt),so=()=>[kt(d,(o,f)=>b(l,f)===-1?void 0:kt(o,(g,T)=>b(b(u,f),T)===-1?void 0:kt(g,([,v])=>v,v=>gs(v)),W,Pt),W,Pt),kt(m,([,o])=>o,o=>gs(o)),1],no=()=>[!W(d),!W(m),fs(d,Di,gs),fs(w),kt(m,Di,gs),kt(p),kt(l),rn(u),fs(a),kt(S)],Si=o=>(n>0&&(n--,n==0&&(n=1,ti(1),W(d)||si(1),ei(1),W(m)||ni(1),o?.(vt)&&(J(d,(f,g)=>J(f,(T,v)=>J(T,([A],N)=>Ai(vt,g,v,N,A)))),ze(d),J(m,([f],g)=>bi(vt,g,f)),ze(m)),it(gt[0],void 0),n=-1,ti(0),W(d)||si(0),ei(0),W(m)||ni(0),r[1]?.(),it(gt[1],void 0),r[2]?.(),n=0,s=ns(),i=is(),Wt([l,h,c,u,a,d,w,S,m,p],ze))),vt),vt={getContent:Br,getTables:Js,getTableIds:At,getTable:$r,getTableCellIds:ri,getRowCount:oi,getRowIds:pe,getSortedRowIds:ts,getRow:Mr,getCellIds:Us,getCell:es,getValues:Ks,getValueIds:Ys,getValue:ss,hasTables:ns,hasTable:li,hasTableCell:ci,hasRow:hi,hasCell:ui,hasValues:is,hasValue:ai,getTablesJson:Vr,getValuesJson:_r,getJson:Nr,getTablesSchemaJson:Pr,getValuesSchemaJson:zr,getSchemaJson:Or,hasTablesSchema:()=>t,hasValuesSchema:()=>e,setContent:Fr,setTables:rs,setTable:Hr,setRow:Wr,addRow:Jr,setPartialRow:Ur,setCell:Kr,setValues:os,setPartialValues:Yr,setValue:Gr,applyChanges:Zr,setTablesJson:fi,setValuesJson:Qr,setJson:Xr,setTablesSchema:di,setValuesSchema:gi,setSchema:Ir,delTables:ls,delTable:pi,delRow:mi,delCell:qr,delValues:cs,delValue:to,delTablesSchema:yi,delValuesSchema:Gs,delSchema:eo,transaction:Zs,startTransaction:wi,getTransactionChanges:so,getTransactionLog:no,finishTransaction:Si,forEachTable:o=>J(L,(f,g)=>o(g,T=>J(f,(v,A)=>T(A,N=>bt(v,N))))),forEachTableCell:(o,f)=>bt(b(V,X(o)),f),forEachRow:(o,f)=>J(b(L,X(o)),(g,T)=>f(T,v=>bt(g,v))),forEachCell:(o,f,g)=>bt(b(b(L,X(o)),X(f)),g),forEachValue:o=>bt(k,o),addSortedRowIdsListener:(o,f,g,T,v,A,N)=>Es(o)?ii(o.tableId,o.cellId,[o.descending??!1,o.offset??0,o.limit],f,g):ii(o,f,[g,T,v],A,N),addStartTransactionListener:o=>Tt(o,I),addWillFinishTransactionListener:o=>Tt(o,gt[0]),addDidFinishTransactionListener:o=>Tt(o,gt[1]),callListener:o=>(Ct(o),vt),delListener:o=>(ge(o),vt),getListenerStats:()=>({hasTables:ht(M),tables:ht(E),tableIds:ht($),hasTable:ht(G),table:ht(Y),tableCellIds:ht(j),hasTableCell:ht(z,Le),rowCount:ht(Q),rowIds:ht(st),sortedRowIds:ht(et),hasRow:ht(wt,Le),row:ht(ft,Le),cellIds:ht(Z,Le),hasCell:ht(nt,Is),cell:ht(ot,Is),invalidCell:ht(R,Is),hasValues:ht(Lt),values:ht(jt),valueIds:ht(Nt),hasValue:ht(dt),value:ht(F),invalidValue:ht(K),transaction:Os(I)+ht(gt)}),isMergeable:()=>!1,createStore:or,addListener:Tt,callListeners:it,setInternalListeners:(o,f,g,T,v)=>r=[o,f,g,T,v]};return Yt({[oe+vi]:[0,M,[],()=>[ns()]],[vi]:[0,E],[ho]:[0,$],[oe+xe]:[1,G,[At],o=>[li(...o)]],[xe]:[1,Y,[At]],[xe+xi]:[1,j,[At]],[oe+xe+xs]:[2,z,[At,ri],o=>[ci(...o)]],[uo]:[1,Q,[At]],[ao]:[1,st,[At]],[oe+As]:[2,wt,[At,pe],o=>[hi(...o)]],[As]:[2,ft,[At,pe]],[xi]:[2,Z,[At,pe]],[oe+xs]:[3,nt,[At,pe,Us],o=>[ui(...o)]],[xs]:[3,ot,[At,pe,Us],o=>ds(es(...o))],InvalidCell:[3,R],[oe+Li]:[0,Lt,[],()=>[is()]],[Li]:[0,jt],[fo]:[0,Nt],[oe+bs]:[1,dt,[Ys],o=>[ai(...o)]],[bs]:[1,F,[Ys],o=>ds(ss(o[0]))],InvalidValue:[1,K]},([o,f,g,T],v)=>{vt[co+v+lo]=(...A)=>Tt(A[o],f[A[o+1]?1:0],o>0?Ci(A,0,o):void 0,g,T)}),er(vt)},Ds="",lr="￼",Vo=globalThis,ji=Vo.window,zt=t=>t==null,js=(t,e,s)=>zt(t)?s?.():e(t),cn=t=>Array.isArray(t),ue=t=>t.length,_o=(t,e)=>t.test(e),cr=t=>{throw new Error(t)},Te=async(t,e,s)=>{try{return await t()}catch(i){e?.(i)}},hn=(t,e)=>t.forEach(e),No=(t,e)=>t.splice(0,e),Tn=(t,...e)=>t.push(...e),hr=t=>t.shift(),Fs=Object,Bi=t=>Fs.getPrototypeOf(t),Po=t=>!zt(t)&&js(Bi(t),e=>e==Fs.prototype||zt(Bi(e)),()=>!0),zo=Fs.keys,Oo=Fs.freeze,Fo=t=>ue(zo(t)),ps=t=>Po(t)&&Fo(t)==0,Ho=JSON.stringify,Wo=JSON.parse,Jo=t=>Ho(t,(e,s)=>s===void 0?lr:s),$i=t=>Wo(t,(e,s)=>s===lr?void 0:s),Uo=t=>t?.size??0,Ko=(t,e)=>t?.has(e)??!1,ur=t=>zt(t)||Uo(t)==0,ar=(t,e)=>t?.forEach(e),fr=(t,e)=>t?.delete(e),Ye=t=>new Map(t),Bt=(t,e)=>t?.get(e),ae=(t,e,s)=>zt(s)?(fr(t,e),t):t?.set(e,s),un=(t,e,s,i)=>(Ko(t,e)?i?.(Bt(t,e)):ae(t,e,s()),Bt(t,e)),an=(t,e,s,i,n=0)=>js((s?un:Bt)(t,e[n],n>ue(e)-2?s:Ye),r=>{if(n>ue(e)-2)return i?.(r)&&ae(t,e[n]),r;const l=an(r,e,s,i,n+1);return ur(r)&&ae(t,e[n]),l}),Yo=/^\d+$/,Go=()=>{const t=[];let e=0;return[s=>(s?hr(t):null)??Ds+e++,s=>{_o(Yo,s)&&ue(t)<1e3&&Tn(t,s)}]},Zo=t=>new Set(cn(t)||zt(t)?t:[t]),Qo=(t,e)=>t?.add(e),Xo=(t,e=[Ds])=>{const s=[],i=(n,r)=>r==ue(e)?Tn(s,n):e[r]===null?ar(n,l=>i(l,r+1)):hn([e[r],null],l=>i(Bt(n,l),r+1));return i(t,0),s},Io=t=>{let e;const[s,i]=Go(),n=Ye();return[(u,a,d,S=[],m=()=>[])=>{e??=t();const w=s(1);return ae(n,w,[u,a,d,S,m]),Qo(an(a,d??[Ds],Zo),w),w},(u,a,...d)=>hn(Xo(u,a),S=>ar(S,m=>Bt(n,m)[0](e,...a??[],...d))),u=>js(Bt(n,u),([,a,d])=>(an(a,d??[Ds],void 0,S=>(fr(S,u),ur(S)?1:0)),ae(n,u),i(u),d)),u=>js(Bt(n,u),([a,,d=[],S,m])=>{const w=(...p)=>{const y=ue(p);y==ue(d)?a(e,...p,...m(p)):zt(d[y])?hn(S[y]?.(...p)??[],C=>w(...p,C)):w(...p,d[y])};w()})]},ms=Ye(),ys=Ye(),qo=(t=1,e,s)=>t!=1&&e.isMergeable()?[1,e.getMergeableContent,()=>e.getTransactionMergeableChanges(!s),([[i],[n]])=>!ps(i)||!ps(n),e.setDefaultContent]:t!=2?[0,e.getContent,e.getTransactionChanges,([i,n])=>!ps(i)||!ps(n),e.setContent]:cr("Store type not supported by this Persister"),tl=(t,e,s,i,n,r,l,h={},c=0,u=[])=>{let a=0,d=0,S=0,m,w,p;un(ms,u,()=>0),un(ys,u,()=>[]);const y=Ye(),[C,x,B,P,O]=qo(l,t,c),[V,L,k]=Io(()=>dt),M=F=>{F!=a&&(a=F,L(y,void 0,a))},E=async()=>{if(!Bt(ms,u)){for(ae(ms,u,1);!zt(m=hr(Bt(ys,u)));)await Te(m,r);ae(ms,u,0)}},$=F=>{(C&&cn(F?.[0])?F?.[2]===1?t.applyMergeableChanges:t.setMergeableContent:F?.[2]===1?t.applyChanges:t.setContent)(F)},G=async F=>(a!=2&&(M(1),d++,await K(async()=>{await Te(async()=>{const I=await e();cn(I)?$(I):F?O(F):cr(`Content is not an array: ${I}`)},()=>{F&&O(F)}),M(0)})),dt),Y=async F=>(j(),await G(F),await Te(async()=>w=await i(async(I,gt)=>{gt||I?a!=2&&(M(1),d++,$(gt??I),M(0)):await G()}),r),dt),j=async()=>(w&&(await Te(()=>n(w),r),w=void 0),dt),z=()=>!zt(w),Q=async F=>(a!=1&&(M(2),S++,await K(async()=>{await Te(()=>s(x,F),r),M(0)})),dt),st=async()=>(et(),await Q(),p=t.addDidFinishTransactionListener(()=>{const F=B();P(F)&&Q(F)}),dt),et=async()=>(p&&(t.delListener(p),p=void 0),dt),wt=()=>!zt(p),ft=async(F,I=!1)=>{const[gt,Tt]=I?[st,Y]:[Y,st];return await gt(F),await Tt(F),dt},Z=async(F=!1)=>{const[I,gt]=F?[et,j]:[j,et];return await I(),await gt(),dt},nt=()=>a,ot=F=>V(F,y),R=F=>(k(F),t),K=async(...F)=>(Tn(Bt(ys,u),...F),await E(),dt),dt={load:G,startAutoLoad:Y,stopAutoLoad:j,isAutoLoading:z,save:Q,startAutoSave:st,stopAutoSave:et,isAutoSaving:wt,startAutoPersisting:ft,stopAutoPersisting:Z,getStatus:nt,addStatusListener:ot,delListener:R,schedule:K,getStore:()=>t,destroy:()=>(No(Bt(ys,u)),Z()),getStats:()=>({loads:d,saves:S}),...h};return Oo(dt)},Mi="storage",el=(t,e,s,i)=>tl(t,async()=>$i(s.getItem(e)),async c=>s.setItem(e,Jo(c())),c=>{const u=a=>{a.storageArea===s&&a.key===e&&Te(()=>c($i(a.newValue)),c)};return ji.addEventListener(Mi,u),u},c=>ji.removeEventListener(Mi,c),i,3,{getStorageName:()=>e}),sl=(t,e,s)=>el(t,e,localStorage,s),nl={todos:{localId:{type:"string"},id:{type:"number",default:-1},title:{type:"string"},description:{type:"string",default:""},completed:{type:"boolean",default:!1},category:{type:"string",default:"all"},dueAt:{type:"number",default:-1},createdAt:{type:"number",default:Date.now()},updatedAt:{type:"number",default:Date.now()},syncStatus:{type:"string",default:"pending_create"}}},U=or().setTablesSchema(nl),Gt=Mo(U);Gt.setIndexDefinition("todosBySyncStatus","todos","syncStatus");Gt.setIndexDefinition("todosByServerId","todos","id");const dr="todos",Vi=sl(U,dr);(async()=>(localStorage.getItem(dr)&&await Vi.startAutoLoad(),await Vi.startAutoSave()))();const xt="todos",Et={createTodo:(t,e="",s="all",i=-1)=>{try{const n=crypto.randomUUID(),r=Date.now();return U.setRow(xt,n,{localId:n,id:-1,title:t,description:e,completed:!1,category:s,dueAt:i,createdAt:r,updatedAt:r,syncStatus:"pending_create"}),console.log("Created todo with localId:",n),!0}catch(n){return console.error("Failed to create todo",n),!1}},changeSyncStatus:t=>{U.setCell(xt,t,"updatedAt",Date.now()),U.setCell(xt,t,"syncStatus","pending_update")},toggleTodo:t=>{const e=U.getRow(xt,t);if(!e)return console.error("Todo not found:",t),!1;const s=!e.completed;return s===!!e.completed?!1:(U.setCell(xt,t,"completed",s),Et.changeSyncStatus(t),!0)},deleteTodo:t=>U.hasRow(xt,t)?(U.setCell(xt,t,"syncStatus","pending_delete"),!0):(console.error("Todo not found:",t),!1),updateTodoCategory:(t,e="all")=>U.hasRow(xt,t)?(U.setCell(xt,t,"category",e),Et.changeSyncStatus(t),!0):(console.error("Todo not found:",t),!1),updateTodoText:(t,e,s="")=>{if(!U.hasRow(xt,t))return console.error("Todo not found:",t),!1;const i=U.getRow(xt,t),n=String(i?.title??"")!==String(e??""),r=String(i?.description??"")!==String(s??"");return!n&&!r?!1:(U.setPartialRow(xt,t,{title:e,description:s}),Et.changeSyncStatus(t),!0)},updateTodoDueDate:(t,e=-1)=>{if(!U.hasRow(xt,t))return console.error("Todo not found:",t),!1;const s=U.getRow(xt,t),i=Number(s?.dueAt??-1),n=Number(e??-1);return i===n?!1:(U.setCell(xt,t,"dueAt",n),Et.changeSyncStatus(t),!0)},updateTodo:(t,e,s="",i="all",n=-1)=>U.hasRow(xt,t)?(Et.updateTodoText(t,e,s),Et.updateTodoDueDate(t,n),Et.updateTodoCategory(t,i),Et.updateTodoCategory(t,i),!0):(console.error("Todo not found:",t),!1)},il="modulepreload",rl=function(t,e){return new URL(t,e).href},_i={},ol=function(e,s,i){let n=Promise.resolve();if(s&&s.length>0){let u=function(a){return Promise.all(a.map(d=>Promise.resolve(d).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};const l=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),c=h?.nonce||h?.getAttribute("nonce");n=u(s.map(a=>{if(a=rl(a,i),a in _i)return;_i[a]=!0;const d=a.endsWith(".css"),S=d?'[rel="stylesheet"]':"";if(i)for(let w=l.length-1;w>=0;w--){const p=l[w];if(p.href===a&&(!d||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${S}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":il,d||(m.as="script"),m.crossOrigin="",m.href=a,c&&m.setAttribute("nonce",c),document.head.appendChild(m),d)return new Promise((w,p)=>{m.addEventListener("load",w),m.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})}))}function r(l){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=l,window.dispatchEvent(h),!h.defaultPrevented)throw l}return n.then(l=>{for(const h of l||[])h.status==="rejected"&&r(h.reason);return e().catch(r)})};var D;function St(t,e,s){const i=typeof s,n=typeof t;if(i!=="undefined"){if(n!=="undefined"){if(s){if(n==="function"&&i===n)return function(h){return t(s(h))};if(e=t.constructor,e===s.constructor){if(e===Array)return s.concat(t);if(e===Map){var r=new Map(s);for(var l of t)r.set(l[0],l[1]);return r}if(e===Set){l=new Set(s);for(r of t.values())l.add(r);return l}}}return t}return s}return n==="undefined"?e:t}function ye(t,e){return typeof t>"u"?e:t}function pt(){return Object.create(null)}function $t(t){return typeof t=="string"}function He(t){return typeof t=="object"}function We(t,e){if($t(e))t=t[e];else for(let s=0;t&&s<e.length;s++)t=t[e[s]];return t}const ll=/[^\p{L}\p{N}]+/u,cl=/(\d{3})/g,hl=/(\D)(\d{3})/g,ul=/(\d{3})(\D)/g,Ni=/[\u0300-\u036f]/g;function Je(t={}){if(!this||this.constructor!==Je)return new Je(...arguments);if(arguments.length)for(t=0;t<arguments.length;t++)this.assign(arguments[t]);else this.assign(t)}D=Je.prototype;D.assign=function(t){this.normalize=St(t.normalize,!0,this.normalize);let e=t.include,s=e||t.exclude||t.split,i;if(s||s===""){if(typeof s=="object"&&s.constructor!==RegExp){let n="";i=!e,e||(n+="\\p{Z}"),s.letter&&(n+="\\p{L}"),s.number&&(n+="\\p{N}",i=!!e),s.symbol&&(n+="\\p{S}"),s.punctuation&&(n+="\\p{P}"),s.control&&(n+="\\p{C}"),(s=s.char)&&(n+=typeof s=="object"?s.join(""):s);try{this.split=new RegExp("["+(e?"^":"")+n+"]+","u")}catch{this.split=/\s+/}}else this.split=s,i=s===!1||"a1a".split(s).length<2;this.numeric=St(t.numeric,i)}else{try{this.split=St(this.split,ll)}catch{this.split=/\s+/}this.numeric=St(t.numeric,St(this.numeric,!0))}if(this.prepare=St(t.prepare,null,this.prepare),this.finalize=St(t.finalize,null,this.finalize),s=t.filter,this.filter=typeof s=="function"?s:St(s&&new Set(s),null,this.filter),this.dedupe=St(t.dedupe,!0,this.dedupe),this.matcher=St((s=t.matcher)&&new Map(s),null,this.matcher),this.mapper=St((s=t.mapper)&&new Map(s),null,this.mapper),this.stemmer=St((s=t.stemmer)&&new Map(s),null,this.stemmer),this.replacer=St(t.replacer,null,this.replacer),this.minlength=St(t.minlength,1,this.minlength),this.maxlength=St(t.maxlength,1024,this.maxlength),this.rtl=St(t.rtl,!1,this.rtl),(this.cache=s=St(t.cache,!0,this.cache))&&(this.F=null,this.L=typeof s=="number"?s:2e5,this.B=new Map,this.D=new Map,this.I=this.H=128),this.h="",this.J=null,this.A="",this.K=null,this.matcher)for(const n of this.matcher.keys())this.h+=(this.h?"|":"")+n;if(this.stemmer)for(const n of this.stemmer.keys())this.A+=(this.A?"|":"")+n;return this};D.addStemmer=function(t,e){return this.stemmer||(this.stemmer=new Map),this.stemmer.set(t,e),this.A+=(this.A?"|":"")+t,this.K=null,this.cache&&fe(this),this};D.addFilter=function(t){return typeof t=="function"?this.filter=t:(this.filter||(this.filter=new Set),this.filter.add(t)),this.cache&&fe(this),this};D.addMapper=function(t,e){return typeof t=="object"?this.addReplacer(t,e):t.length>1?this.addMatcher(t,e):(this.mapper||(this.mapper=new Map),this.mapper.set(t,e),this.cache&&fe(this),this)};D.addMatcher=function(t,e){return typeof t=="object"?this.addReplacer(t,e):t.length<2&&(this.dedupe||this.mapper)?this.addMapper(t,e):(this.matcher||(this.matcher=new Map),this.matcher.set(t,e),this.h+=(this.h?"|":"")+t,this.J=null,this.cache&&fe(this),this)};D.addReplacer=function(t,e){return typeof t=="string"?this.addMatcher(t,e):(this.replacer||(this.replacer=[]),this.replacer.push(t,e),this.cache&&fe(this),this)};D.encode=function(t,e){if(this.cache&&t.length<=this.H)if(this.F){if(this.B.has(t))return this.B.get(t)}else this.F=setTimeout(fe,50,this);this.normalize&&(typeof this.normalize=="function"?t=this.normalize(t):t=Ni?t.normalize("NFKD").replace(Ni,"").toLowerCase():t.toLowerCase()),this.prepare&&(t=this.prepare(t)),this.numeric&&t.length>3&&(t=t.replace(hl,"$1 $2").replace(ul,"$1 $2").replace(cl,"$1 "));const s=!(this.dedupe||this.mapper||this.filter||this.matcher||this.stemmer||this.replacer);let i=[],n=pt(),r,l,h=this.split||this.split===""?t.split(this.split):[t];for(let u=0,a,d;u<h.length;u++)if((a=d=h[u])&&!(a.length<this.minlength||a.length>this.maxlength)){if(e){if(n[a])continue;n[a]=1}else{if(r===a)continue;r=a}if(s)i.push(a);else if(!this.filter||(typeof this.filter=="function"?this.filter(a):!this.filter.has(a))){if(this.cache&&a.length<=this.I)if(this.F){var c=this.D.get(a);if(c||c===""){c&&i.push(c);continue}}else this.F=setTimeout(fe,50,this);if(this.stemmer){this.K||(this.K=new RegExp("(?!^)("+this.A+")$"));let S;for(;S!==a&&a.length>2;)S=a,a=a.replace(this.K,m=>this.stemmer.get(m))}if(a&&(this.mapper||this.dedupe&&a.length>1)){c="";for(let S=0,m="",w,p;S<a.length;S++)w=a.charAt(S),w===m&&this.dedupe||((p=this.mapper&&this.mapper.get(w))||p===""?p===m&&this.dedupe||!(m=p)||(c+=p):c+=m=w);a=c}if(this.matcher&&a.length>1&&(this.J||(this.J=new RegExp("("+this.h+")","g")),a=a.replace(this.J,S=>this.matcher.get(S))),a&&this.replacer)for(c=0;a&&c<this.replacer.length;c+=2)a=a.replace(this.replacer[c],this.replacer[c+1]);if(this.cache&&d.length<=this.I&&(this.D.set(d,a),this.D.size>this.L&&(this.D.clear(),this.I=this.I/1.1|0)),a){if(a!==d)if(e){if(n[a])continue;n[a]=1}else{if(l===a)continue;l=a}i.push(a)}}}return this.finalize&&(i=this.finalize(i)||i),this.cache&&t.length<=this.H&&(this.B.set(t,i),this.B.size>this.L&&(this.B.clear(),this.H=this.H/1.1|0)),i};function fe(t){t.F=null,t.B.clear(),t.D.clear()}function vn(t,e,s){s||(e||typeof t!="object"?typeof e=="object"&&(s=e,e=0):s=t),s&&(t=s.query||t,e=s.limit||e);let i=""+(e||0);s&&(i+=(s.offset||0)+!!s.context+!!s.suggest+(s.resolve!==!1)+(s.resolution||this.resolution)+(s.boost||0)),t=(""+t).toLowerCase(),this.cache||(this.cache=new de);let n=this.cache.get(t+i);if(!n){const r=s&&s.cache;r&&(s.cache=!1),n=this.search(t,e,s),r&&(s.cache=r),this.cache.set(t+i,n)}return n}function de(t){this.limit=t&&t!==!0?t:1e3,this.cache=new Map,this.h=""}de.prototype.set=function(t,e){this.cache.set(this.h=t,e),this.cache.size>this.limit&&this.cache.delete(this.cache.keys().next().value)};de.prototype.get=function(t){const e=this.cache.get(t);return e&&this.h!==t&&(this.cache.delete(t),this.cache.set(this.h=t,e)),e};de.prototype.remove=function(t){for(const e of this.cache){const s=e[0];e[1].includes(t)&&this.cache.delete(s)}};de.prototype.clear=function(){this.cache.clear(),this.h=""};const Pi={normalize:!1,numeric:!1,dedupe:!1},ws={},en=new Map([["b","p"],["v","f"],["w","f"],["z","s"],["x","s"],["d","t"],["n","m"],["c","k"],["g","k"],["j","k"],["q","k"],["i","e"],["y","e"],["u","o"]]),zi=new Map([["ae","a"],["oe","o"],["sh","s"],["kh","k"],["th","t"],["ph","f"],["pf","f"]]),Oi=[/([^aeo])h(.)/g,"$1$2",/([aeo])h([^aeo]|$)/g,"$1$2",/(.)\1+/g,"$1"],Fi={a:"",e:"",i:"",o:"",u:"",y:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,ß:2,d:3,t:3,l:4,m:5,n:5,r:6};var xn={Exact:Pi,Default:ws,Normalize:ws,LatinBalance:{mapper:en},LatinAdvanced:{mapper:en,matcher:zi,replacer:Oi},LatinExtra:{mapper:en,replacer:Oi.concat([/(?!^)[aeo]/g,""]),matcher:zi},LatinSoundex:{dedupe:!1,include:{letter:!0},finalize:function(t){for(let s=0;s<t.length;s++){var e=t[s];let i=e.charAt(0),n=Fi[i];for(let r=1,l;r<e.length&&(l=e.charAt(r),l==="h"||l==="w"||!(l=Fi[l])||l===n||(i+=l,n=l,i.length!==4));r++);t[s]=i}}},CJK:{split:""},LatinExact:Pi,LatinDefault:ws,LatinSimple:ws};function Hi(t,e,s,i){let n=[];for(let r=0,l;r<t.index.length;r++)if(l=t.index[r],e>=l.length)e-=l.length;else{e=l[i?"splice":"slice"](e,s);const h=e.length;if(h&&(n=n.length?n.concat(e):e,s-=h,i&&(t.length-=h),!s))break;e=0}return n}function Re(t){if(!this||this.constructor!==Re)return new Re(t);this.index=t?[t]:[],this.length=t?t.length:0;const e=this;return new Proxy([],{get(s,i){if(i==="length")return e.length;if(i==="push")return function(n){e.index[e.index.length-1].push(n),e.length++};if(i==="pop")return function(){if(e.length)return e.length--,e.index[e.index.length-1].pop()};if(i==="indexOf")return function(n){let r=0;for(let l=0,h,c;l<e.index.length;l++){if(h=e.index[l],c=h.indexOf(n),c>=0)return r+c;r+=h.length}return-1};if(i==="includes")return function(n){for(let r=0;r<e.index.length;r++)if(e.index[r].includes(n))return!0;return!1};if(i==="slice")return function(n,r){return Hi(e,n||0,r||e.length,!1)};if(i==="splice")return function(n,r){return Hi(e,n||0,r||e.length,!0)};if(i==="constructor")return Array;if(typeof i!="symbol")return(s=e.index[i/2**31|0])&&s[i]},set(s,i,n){return s=i/2**31|0,(e.index[s]||(e.index[s]=[]))[i]=n,e.length++,!0}})}Re.prototype.clear=function(){this.index.length=0};Re.prototype.push=function(){};function Mt(t=8){if(!this||this.constructor!==Mt)return new Mt(t);this.index=pt(),this.h=[],this.size=0,t>32?(this.B=pr,this.A=BigInt(t)):(this.B=gr,this.A=t)}Mt.prototype.get=function(t){const e=this.index[this.B(t)];return e&&e.get(t)};Mt.prototype.set=function(t,e){var s=this.B(t);let i=this.index[s];i?(s=i.size,i.set(t,e),(s-=i.size)&&this.size++):(this.index[s]=i=new Map([[t,e]]),this.h.push(i),this.size++)};function Vt(t=8){if(!this||this.constructor!==Vt)return new Vt(t);this.index=pt(),this.h=[],this.size=0,t>32?(this.B=pr,this.A=BigInt(t)):(this.B=gr,this.A=t)}Vt.prototype.add=function(t){var e=this.B(t);let s=this.index[e];s?(e=s.size,s.add(t),(e-=s.size)&&this.size++):(this.index[e]=s=new Set([t]),this.h.push(s),this.size++)};D=Mt.prototype;D.has=Vt.prototype.has=function(t){const e=this.index[this.B(t)];return e&&e.has(t)};D.delete=Vt.prototype.delete=function(t){const e=this.index[this.B(t)];e&&e.delete(t)&&this.size--};D.clear=Vt.prototype.clear=function(){this.index=pt(),this.h=[],this.size=0};D.values=Vt.prototype.values=function*(){for(let t=0;t<this.h.length;t++)for(let e of this.h[t].values())yield e};D.keys=Vt.prototype.keys=function*(){for(let t=0;t<this.h.length;t++)for(let e of this.h[t].keys())yield e};D.entries=Vt.prototype.entries=function*(){for(let t=0;t<this.h.length;t++)for(let e of this.h[t].entries())yield e};function gr(t){let e=2**this.A-1;if(typeof t=="number")return t&e;let s=0,i=this.A+1;for(let n=0;n<t.length;n++)s=(s*i^t.charCodeAt(n))&e;return this.A===32?s+2**31:s}function pr(t){let e=BigInt(2)**this.A-BigInt(1);var s=typeof t;if(s==="bigint")return t&e;if(s==="number")return BigInt(t)&e;s=BigInt(0);let i=this.A+BigInt(1);for(let n=0;n<t.length;n++)s=(s*i^BigInt(t.charCodeAt(n)))&e;return s}let we,Ne;async function al(t){t=t.data;var e=t.task;const s=t.id;let i=t.args;switch(e){case"init":Ne=t.options||{},(e=t.factory)?(Function("return "+e)()(self),we=new self.FlexSearch.Index(Ne),delete self.FlexSearch):we=new _t(Ne),postMessage({id:s});break;default:let n;e==="export"&&(i[1]?(i[0]=Ne.export,i[2]=0,i[3]=1):i=null),e==="import"?i[0]&&(t=await Ne.import.call(we,i[0]),we.import(i[0],t)):((n=i&&we[e].apply(we,i))&&n.then&&(n=await n),n&&n.await&&(n=await n.await),e==="search"&&n.result&&(n=n.result)),postMessage(e==="search"?{id:s,msg:n}:{id:s})}}function Ln(t){Se.call(t,"add"),Se.call(t,"append"),Se.call(t,"search"),Se.call(t,"update"),Se.call(t,"remove"),Se.call(t,"searchCache")}let fn,Wi,Ls;function fl(){fn=Ls=0}function Se(t){this[t+"Async"]=function(){const e=arguments;var s=e[e.length-1];let i;if(typeof s=="function"&&(i=s,delete e[e.length-1]),fn?Ls||(Ls=Date.now()-Wi>=this.priority*this.priority*3):(fn=setTimeout(fl,0),Wi=Date.now()),Ls){const r=this;return new Promise(l=>{setTimeout(function(){l(r[t+"Async"].apply(r,e))},0)})}const n=this[t].apply(this,e);return s=n.then?n:new Promise(r=>r(n)),i&&s.then(i),s}}let Xt=0;function Ee(t={},e){function s(h){function c(u){u=u.data||u;const a=u.id,d=a&&r.h[a];d&&(d(u.msg),delete r.h[a])}if(this.worker=h,this.h=pt(),this.worker)return n?this.worker.on("message",c):this.worker.onmessage=c,t.config?new Promise(function(u){Xt>1e9&&(Xt=0),r.h[++Xt]=function(){u(r)},r.worker.postMessage({id:Xt,task:"init",factory:i,options:t})}):(this.priority=t.priority||4,this.encoder=e||null,this.worker.postMessage({task:"init",factory:i,options:t}),this)}if(!this||this.constructor!==Ee)return new Ee(t);let i=typeof self<"u"?self._factory:typeof window<"u"?window._factory:null;i&&(i=i.toString());const n=typeof window>"u",r=this,l=dl(i,n,t.worker);return l.then?l.then(function(h){return s.call(r,h)}):s.call(this,l)}ne("add");ne("append");ne("search");ne("update");ne("remove");ne("clear");ne("export");ne("import");Ee.prototype.searchCache=vn;Ln(Ee.prototype);function ne(t){Ee.prototype[t]=function(){const e=this,s=[].slice.call(arguments);var i=s[s.length-1];let n;return typeof i=="function"&&(n=i,s.pop()),i=new Promise(function(r){t==="export"&&typeof s[0]=="function"&&(s[0]=null),Xt>1e9&&(Xt=0),e.h[++Xt]=r,e.worker.postMessage({task:t,id:Xt,args:s})}),n?(i.then(n),this):i}}function dl(t,e,s){return e?typeof module<"u"?new(require("worker_threads")).Worker(__dirname+"/worker/node.js"):ol(()=>import("./__vite-browser-external-BIHI7g3E.js"),[],import.meta.url).then(function(i){return new i.Worker(import.meta.dirname+"/node/node.mjs")}):t?new window.Worker(URL.createObjectURL(new Blob(["onmessage="+al.toString()],{type:"text/javascript"}))):new window.Worker(typeof s=="string"?s:import.meta.url.replace("/worker.js","/worker/worker.js").replace("flexsearch.bundle.module.min.js","module/worker/worker.js").replace("flexsearch.bundle.module.min.mjs","module/worker/worker.js"),{type:"module"})}De.prototype.add=function(t,e,s){if(He(t)&&(e=t,t=We(e,this.key)),e&&(t||t===0)){if(!s&&this.reg.has(t))return this.update(t,e);for(let h=0,c;h<this.field.length;h++){c=this.B[h];var i=this.index.get(this.field[h]);if(typeof c=="function"){var n=c(e);n&&i.add(t,n,s,!0)}else n=c.G,(!n||n(e))&&(c.constructor===String?c=[""+c]:$t(c)&&(c=[c]),gn(e,c,this.D,0,i,t,c[0],s))}if(this.tag)for(i=0;i<this.A.length;i++){var r=this.A[i];n=this.tag.get(this.F[i]);let h=pt();if(typeof r=="function"){if(r=r(e),!r)continue}else{var l=r.G;if(l&&!l(e))continue;r.constructor===String&&(r=""+r),r=We(e,r)}if(n&&r){$t(r)&&(r=[r]);for(let c=0,u,a;c<r.length;c++)if(u=r[c],!h[u]&&(h[u]=1,(l=n.get(u))?a=l:n.set(u,a=[]),!s||!a.includes(t))){if(a.length===2**31-1){if(l=new Re(a),this.fastupdate)for(let d of this.reg.values())d.includes(a)&&(d[d.indexOf(a)]=l);n.set(u,a=l)}a.push(t),this.fastupdate&&((l=this.reg.get(t))?l.push(a):this.reg.set(t,[a]))}}}if(this.store&&(!s||!this.store.has(t))){let h;if(this.h){h=pt();for(let c=0,u;c<this.h.length;c++){if(u=this.h[c],(s=u.G)&&!s(e))continue;let a;if(typeof u=="function"){if(a=u(e),!a)continue;u=[u.O]}else if($t(u)||u.constructor===String){h[u]=e[u];continue}dn(e,h,u,0,u[0],a)}}this.store.set(t,h||e)}this.worker&&(this.fastupdate||this.reg.add(t))}return this};function dn(t,e,s,i,n,r){if(t=t[n],i===s.length-1)e[n]=r||t;else if(t)if(t.constructor===Array)for(e=e[n]=Array(t.length),n=0;n<t.length;n++)dn(t,e,s,i,n);else e=e[n]||(e[n]=pt()),n=s[++i],dn(t,e,s,i,n)}function gn(t,e,s,i,n,r,l,h){if(t=t[l])if(i===e.length-1){if(t.constructor===Array){if(s[i]){for(e=0;e<t.length;e++)n.add(r,t[e],!0,!0);return}t=t.join(" ")}n.add(r,t,h,!0)}else if(t.constructor===Array)for(l=0;l<t.length;l++)gn(t,e,s,i,n,r,l,h);else l=e[++i],gn(t,e,s,i,n,r,l,h)}function Cn(t,e,s,i){if(!t.length)return t;if(t.length===1)return t=t[0],t=s||t.length>e?t.slice(s,s+e):t,i?ke.call(this,t):t;let n=[];for(let r=0,l,h;r<t.length;r++)if((l=t[r])&&(h=l.length)){if(s){if(s>=h){s-=h;continue}l=l.slice(s,s+e),h=l.length,s=0}if(h>e&&(l=l.slice(0,e),h=e),!n.length&&h>=e)return i?ke.call(this,l):l;if(n.push(l),e-=h,!e)break}return n=n.length>1?[].concat.apply([],n):n[0],i?ke.call(this,n):n}function Hs(t,e,s,i){var n=i[0];if(n[0]&&n[0].query)return t[e].apply(t,n);if(!(e!=="and"&&e!=="not"||t.result.length||t.await||n.suggest))return i.length>1&&(n=i[i.length-1]),(i=n.resolve)?t.await||t.result:t;let r=[],l=0,h=0,c,u,a,d,S;for(e=0;e<i.length;e++)if(n=i[e]){var m=void 0;if(n.constructor===rt)m=n.await||n.result;else if(n.then||n.constructor===Array)m=n;else{l=n.limit||0,h=n.offset||0,a=n.suggest,u=n.resolve,c=((d=n.highlight||t.highlight)||n.enrich)&&u,m=n.queue;let w=n.async||m,p=n.index,y=n.query;if(p?t.index||(t.index=p):p=t.index,y||n.tag){const C=n.field||n.pluck;if(C&&(!y||t.query&&!d||(t.query=y,t.field=C,t.highlight=d),p=p.index.get(C)),m&&(S||t.await)){S=1;let x;const B=t.C.length,P=new Promise(function(O){x=O});(function(O,V){P.h=function(){V.index=null,V.resolve=!1;let L=w?O.searchAsync(V):O.search(V);return L.then?L.then(function(k){return t.C[B]=k=k.result||k,x(k),k}):(L=L.result||L,x(L),L)}})(p,Object.assign({},n)),t.C.push(P),r[e]=P;continue}else n.resolve=!1,n.index=null,m=w?p.searchAsync(n):p.search(n),n.resolve=u,n.index=p}else if(n.and)m=Ss(n,"and",p);else if(n.or)m=Ss(n,"or",p);else if(n.not)m=Ss(n,"not",p);else if(n.xor)m=Ss(n,"xor",p);else continue}m.await?(S=1,m=m.await):m.then?(S=1,m=m.then(function(w){return w.result||w})):m=m.result||m,r[e]=m}if(S&&!t.await&&(t.await=new Promise(function(w){t.return=w})),S){const w=Promise.all(r).then(function(p){for(let y=0;y<t.C.length;y++)if(t.C[y]===w){t.C[y]=function(){return s.call(t,p,l,h,c,u,a,d)};break}kn(t)});t.C.push(w)}else if(t.await)t.C.push(function(){return s.call(t,r,l,h,c,u,a,d)});else return s.call(t,r,l,h,c,u,a,d);return u?t.await||t.result:t}function Ss(t,e,s){t=t[e];const i=t[0]||t;return i.index||(i.index=s),s=new rt(i),t.length>1&&(s=s[e].apply(s,t.slice(1))),s}rt.prototype.or=function(){return Hs(this,"or",gl,arguments)};function gl(t,e,s,i,n,r,l){return t.length&&(this.result.length&&t.push(this.result),t.length<2?this.result=t[0]:(this.result=mr(t,e,s,!1,this.h),s=0)),n&&(this.await=null),n?this.resolve(e,s,i,l):this}rt.prototype.and=function(){return Hs(this,"and",pl,arguments)};function pl(t,e,s,i,n,r,l){if(!r&&!this.result.length)return n?this.result:this;let h;if(t.length)if(this.result.length&&t.unshift(this.result),t.length<2)this.result=t[0];else{let c=0;for(let u=0,a,d;u<t.length;u++)if((a=t[u])&&(d=a.length))c<d&&(c=d);else if(!r){c=0;break}c?(this.result=Bs(t,c,e,s,r,this.h,n),h=!0):this.result=[]}else r||(this.result=t);return n&&(this.await=null),n?this.resolve(e,s,i,l,h):this}rt.prototype.xor=function(){return Hs(this,"xor",ml,arguments)};function ml(t,e,s,i,n,r,l){if(t.length)if(this.result.length&&t.unshift(this.result),t.length<2)this.result=t[0];else{t:{r=s;var h=this.h;const c=[],u=pt();let a=0;for(let d=0,S;d<t.length;d++)if(S=t[d]){a<S.length&&(a=S.length);for(let m=0,w;m<S.length;m++)if(w=S[m])for(let p=0,y;p<w.length;p++)y=w[p],u[y]=u[y]?2:1}for(let d=0,S,m=0;d<a;d++)for(let w=0,p;w<t.length;w++)if((p=t[w])&&(S=p[d])){for(let y=0,C;y<S.length;y++)if(C=S[y],u[C]===1)if(r)r--;else if(n){if(c.push(C),c.length===e){t=c;break t}}else{const x=d+(w?h:0);if(c[x]||(c[x]=[]),c[x].push(C),++m===e){t=c;break t}}}t=c}this.result=t,h=!0}else r||(this.result=t);return n&&(this.await=null),n?this.resolve(e,s,i,l,h):this}rt.prototype.not=function(){return Hs(this,"not",yl,arguments)};function yl(t,e,s,i,n,r,l){if(!r&&!this.result.length)return n?this.result:this;if(t.length&&this.result.length){t:{r=s;var h=[];t=new Set(t.flat().flat());for(let c=0,u,a=0;c<this.result.length;c++)if(u=this.result[c]){for(let d=0,S;d<u.length;d++)if(S=u[d],!t.has(S)){if(r)r--;else if(n){if(h.push(S),h.length===e){t=h;break t}}else if(h[c]||(h[c]=[]),h[c].push(S),++a===e){t=h;break t}}}t=h}this.result=t,h=!0}return n&&(this.await=null),n?this.resolve(e,s,i,l,h):this}function Cs(t,e,s,i,n){let r,l,h;typeof n=="string"?(r=n,n=""):r=n.template,l=r.indexOf("$1"),h=r.substring(l+2),l=r.substring(0,l);let c=n&&n.boundary,u=!n||n.clip!==!1,a=n&&n.merge&&h&&l&&new RegExp(h+" "+l,"g");n=n&&n.ellipsis;var d=0;if(typeof n=="object"){var S=n.template;d=S.length-2,n=n.pattern}typeof n!="string"&&(n=n===!1?"":"..."),d&&(n=S.replace("$1",n)),S=n.length-d;let m,w;typeof c=="object"&&(m=c.before,m===0&&(m=-1),w=c.after,w===0&&(w=-1),c=c.total||9e5),d=new Map;for(let st=0,et,wt,ft;st<e.length;st++){let Z;if(i)Z=e,ft=i;else{var p=e[st];if(ft=p.field,!ft)continue;Z=p.result}wt=s.get(ft),et=wt.encoder,p=d.get(et),typeof p!="string"&&(p=et.encode(t),d.set(et,p));for(let nt=0;nt<Z.length;nt++){var y=Z[nt].doc;if(!y||(y=We(y,ft),!y))continue;var C=y.trim().split(/\s+/);if(!C.length)continue;y="";var x=[];let ot=[];for(var B=-1,P=-1,O=0,V=0;V<C.length;V++){var L=C[V],k=et.encode(L);k=k.length>1?k.join(" "):k[0];let R;if(k&&L){for(var M=L.length,E=(et.split?L.replace(et.split,""):L).length-k.length,$="",G=0,Y=0;Y<p.length;Y++){var j=p[Y];if(j){var z=j.length;z+=E<0?0:E,G&&z<=G||(j=k.indexOf(j),j>-1&&($=(j?L.substring(0,j):"")+l+L.substring(j,j+z)+h+(j+z<M?L.substring(j+z):""),G=z,R=!0))}}$&&(c&&(B<0&&(B=y.length+(y?1:0)),P=y.length+(y?1:0)+$.length,O+=M,ot.push(x.length),x.push({match:$})),y+=(y?" ":"")+$)}if(!R)L=C[V],y+=(y?" ":"")+L,c&&x.push({text:L});else if(c&&O>=c)break}if(O=ot.length*(r.length-2),m||w||c&&y.length-O>c)if(O=c+O-S*2,V=P-B,m>0&&(V+=m),w>0&&(V+=w),V<=O)C=m?B-(m>0?m:0):B-((O-V)/2|0),x=w?P+(w>0?w:0):C+O,u||(C>0&&y.charAt(C)!==" "&&y.charAt(C-1)!==" "&&(C=y.indexOf(" ",C),C<0&&(C=0)),x<y.length&&y.charAt(x-1)!==" "&&y.charAt(x)!==" "&&(x=y.lastIndexOf(" ",x),x<P?x=P:++x)),y=(C?n:"")+y.substring(C,x)+(x<y.length?n:"");else{for(P=[],B={},O={},V={},L={},k={},$=E=M=0,Y=G=1;;){var Q=void 0;for(let R=0,K;R<ot.length;R++){if(K=ot[R],$)if(E!==$){if(V[R+1])continue;if(K+=$,B[K]){M-=S,O[R+1]=1,V[R+1]=1;continue}if(K>=x.length-1){if(K>=x.length){V[R+1]=1,K>=C.length&&(O[R+1]=1);continue}M-=S}if(y=x[K].text,z=w&&k[R])if(z>0){if(y.length>z)if(V[R+1]=1,u)y=y.substring(0,z);else continue;(z-=y.length)||(z=-1),k[R]=z}else{V[R+1]=1;continue}if(M+y.length+1<=c)y=" "+y,P[R]+=y;else if(u)Q=c-M-1,Q>0&&(y=" "+y.substring(0,Q),P[R]+=y),V[R+1]=1;else{V[R+1]=1;continue}}else{if(V[R])continue;if(K-=E,B[K]){M-=S,V[R]=1,O[R]=1;continue}if(K<=0){if(K<0){V[R]=1,O[R]=1;continue}M-=S}if(y=x[K].text,z=m&&L[R])if(z>0){if(y.length>z)if(V[R]=1,u)y=y.substring(y.length-z);else continue;(z-=y.length)||(z=-1),L[R]=z}else{V[R]=1;continue}if(M+y.length+1<=c)y+=" ",P[R]=y+P[R];else if(u)Q=y.length+1-(c-M),Q>=0&&Q<y.length&&(y=y.substring(Q)+" ",P[R]=y+P[R]),V[R]=1;else{V[R]=1;continue}}else{y=x[K].match,m&&(L[R]=m),w&&(k[R]=w),R&&M++;let Lt;if(K?!R&&S&&(M+=S):(O[R]=1,V[R]=1),K>=C.length-1||K<x.length-1&&x[K+1].match?Lt=1:S&&(M+=S),M-=r.length-2,!R||M+y.length<=c)P[R]=y;else{Q=G=Y=O[R]=0;break}Lt&&(O[R+1]=1,V[R+1]=1)}M+=y.length,Q=B[K]=1}if(Q)E===$?$++:E++;else{if(E===$?G=0:Y=0,!G&&!Y)break;G?(E++,$=E):$++}}y="";for(let R=0,K;R<P.length;R++)K=(O[R]?R?" ":"":(R&&!n?" ":"")+n)+P[R],y+=K;n&&!O[P.length]&&(y+=n)}a&&(y=y.replace(a," ")),Z[nt].highlight=y}if(i)break}return e}function rt(t,e){if(!this||this.constructor!==rt)return new rt(t,e);let s=0,i,n,r,l,h,c;if(t&&t.index){const u=t;if(e=u.index,s=u.boost||0,n=u.query){r=u.field||u.pluck,l=u.highlight;const a=u.resolve;t=u.async||u.queue,u.resolve=!1,u.index=null,t=t?e.searchAsync(u):e.search(u),u.resolve=a,u.index=e,t=t.result||t}else t=[]}if(t&&t.then){const u=this;t=t.then(function(a){u.C[0]=u.result=a.result||a,kn(u)}),i=[t],t=[],h=new Promise(function(a){c=a})}this.index=e||null,this.result=t||[],this.h=s,this.C=i||[],this.await=h||null,this.return=c||null,this.highlight=l||null,this.query=n||"",this.field=r||""}D=rt.prototype;D.limit=function(t){if(this.await){const e=this;this.C.push(function(){return e.limit(t).result})}else if(this.result.length){const e=[];for(let s=0,i;s<this.result.length;s++)if(i=this.result[s])if(i.length<=t){if(e[s]=i,t-=i.length,!t)break}else{e[s]=i.slice(0,t);break}this.result=e}return this};D.offset=function(t){if(this.await){const e=this;this.C.push(function(){return e.offset(t).result})}else if(this.result.length){const e=[];for(let s=0,i;s<this.result.length;s++)(i=this.result[s])&&(i.length<=t?t-=i.length:(e[s]=i.slice(t),t=0));this.result=e}return this};D.boost=function(t){if(this.await){const e=this;this.C.push(function(){return e.boost(t).result})}else this.h+=t;return this};function kn(t,e){let s=t.result;var i=t.await;t.await=null;for(let n=0,r;n<t.C.length;n++)if(r=t.C[n]){if(typeof r=="function")s=r(),t.C[n]=s=s.result||s,n--;else if(r.h)s=r.h(),t.C[n]=s=s.result||s,n--;else if(r.then)return t.await=i}return i=t.return,t.C=[],t.return=null,e||i(s),s}D.resolve=function(t,e,s,i,n){let r=this.await?kn(this,!0):this.result;if(r.then){const l=this;return r.then(function(){return l.resolve(t,e,s,i,n)})}return r.length&&(typeof t=="object"?(i=t.highlight||this.highlight,s=!!i||t.enrich,e=t.offset,t=t.limit):(i=i||this.highlight,s=!!i||s),r=n?s?ke.call(this.index,r):r:Cn.call(this.index,r,t||100,e,s)),this.finalize(r,i)};D.finalize=function(t,e){if(t.then){const i=this;return t.then(function(n){return i.finalize(n,e)})}e&&t.length&&this.query&&(t=Cs(this.query,t,this.index.index,this.field,e));const s=this.return;return this.highlight=this.index=this.result=this.C=this.await=this.return=null,this.query=this.field="",s&&s(t),t};function Bs(t,e,s,i,n,r,l){const h=t.length;let c=[],u,a;u=pt();for(let d=0,S,m,w,p;d<e;d++)for(let y=0;y<h;y++)if(w=t[y],d<w.length&&(S=w[d]))for(let C=0;C<S.length;C++){if(m=S[C],(a=u[m])?u[m]++:(a=0,u[m]=1),p=c[a]||(c[a]=[]),!l){let x=d+(y||!n?0:r||0);p=p[x]||(p[x]=[])}if(p.push(m),l&&s&&a===h-1&&p.length-i===s)return i?p.slice(i):p}if(t=c.length)if(n)c=c.length>1?mr(c,s,i,l,r):(c=c[0])&&s&&c.length>s||i?c.slice(i,s+i):c;else{if(t<h)return[];if(c=c[t-1],s||i)if(l)(c.length>s||i)&&(c=c.slice(i,s+i));else{n=[];for(let d=0,S;d<c.length;d++)if(S=c[d]){if(i&&S.length>i)i-=S.length;else if((s&&S.length>s||i)&&(S=S.slice(i,s+i),s-=S.length,i&&(i-=S.length)),n.push(S),!s)break}c=n}}return c}function mr(t,e,s,i,n){const r=[],l=pt();let h;var c=t.length;let u;if(i){for(n=c-1;n>=0;n--)if(u=(i=t[n])&&i.length){for(c=0;c<u;c++)if(h=i[c],!l[h]){if(l[h]=1,s)s--;else if(r.push(h),r.length===e)return r}}}else for(let a=c-1,d,S=0;a>=0;a--){d=t[a];for(let m=0;m<d.length;m++)if(u=(i=d[m])&&i.length){for(let w=0;w<u;w++)if(h=i[w],!l[h])if(l[h]=1,s)s--;else{let p=(m+(a<c-1&&n||0))/(a+1)|0;if((r[p]||(r[p]=[])).push(h),++S===e)return r}}}return r}function wl(t,e,s,i,n){const r=pt(),l=[];for(let h=0,c;h<e.length;h++){c=e[h];for(let u=0;u<c.length;u++)r[c[u]]=1}if(n){for(let h=0,c;h<t.length;h++)if(c=t[h],r[c]){if(i)i--;else if(l.push(c),r[c]=0,s&&--s===0)break}}else for(let h=0,c,u;h<t.result.length;h++)for(c=t.result[h],e=0;e<c.length;e++)u=c[e],r[u]&&((l[h]||(l[h]=[])).push(u),r[u]=0);return l}De.prototype.search=function(t,e,s,i){s||(!e&&He(t)?(s=t,t=""):He(e)&&(s=e,e=0));let n=[];var r=[];let l,h,c,u,a,d,S=0,m=!0,w;if(s){s.constructor===Array&&(s={index:s}),t=s.query||t,l=s.pluck,h=s.merge,u=s.boost,d=l||s.field||(d=s.index)&&(d.index?null:d);var p=this.tag&&s.tag;c=s.suggest,m=s.resolve!==!1,a=s.cache,w=m&&this.store&&s.highlight;var y=!!w||m&&this.store&&s.enrich;e=s.limit||e;var C=s.offset||0;if(e||(e=m?100:0),p&&(!this.db||!i)){p.constructor!==Array&&(p=[p]);var x=[];for(let L=0,k;L<p.length;L++)if(k=p[L],k.field&&k.tag){var B=k.tag;if(B.constructor===Array)for(var P=0;P<B.length;P++)x.push(k.field,B[P]);else x.push(k.field,B)}else{B=Object.keys(k);for(let M=0,E,$;M<B.length;M++)if(E=B[M],$=k[E],$.constructor===Array)for(P=0;P<$.length;P++)x.push(E,$[P]);else x.push(E,$)}if(p=x,!t){if(r=[],x.length)for(p=0;p<x.length;p+=2){if(this.db){if(i=this.index.get(x[p]),!i)continue;r.push(i=i.db.tag(x[p+1],e,C,y))}else i=Sl.call(this,x[p],x[p+1],e,C,y);n.push(m?{field:x[p],tag:x[p+1],result:i}:[i])}if(r.length){const L=this;return Promise.all(r).then(function(k){for(let M=0;M<k.length;M++)m?n[M].result=k[M]:n[M]=k[M];return m?n:new rt(n.length>1?Bs(n,1,0,0,c,u):n[0],L)})}return m?n:new rt(n.length>1?Bs(n,1,0,0,c,u):n[0],this)}}m||l||!(d=d||this.field)||($t(d)?l=d:(d.constructor===Array&&d.length===1&&(d=d[0]),l=d.field||d.index)),d&&d.constructor!==Array&&(d=[d])}d||(d=this.field);let O;x=(this.worker||this.db)&&!i&&[];for(let L=0,k,M,E;L<d.length;L++){if(M=d[L],this.db&&this.tag&&!this.B[L])continue;let $;if($t(M)||($=M,M=$.field,t=$.query||t,e=ye($.limit,e),C=ye($.offset,C),c=ye($.suggest,c),w=m&&this.store&&ye($.highlight,w),y=!!w||m&&this.store&&ye($.enrich,y),a=ye($.cache,a)),i)k=i[L];else{B=$||s||{},P=B.enrich;var V=this.index.get(M);if(p&&(this.db&&(B.tag=p,B.field=d,O=V.db.support_tag_search),!O&&P&&(B.enrich=!1),O||(B.limit=0,B.offset=0)),k=a?V.searchCache(t,p&&!O?0:e,B):V.search(t,p&&!O?0:e,B),p&&!O&&(B.limit=e,B.offset=C),P&&(B.enrich=P),x){x[L]=k;continue}}if(E=(k=k.result||k)&&k.length,p&&E){if(B=[],P=0,this.db&&i){if(!O)for(V=d.length;V<i.length;V++){let G=i[V];if(G&&G.length)P++,B.push(G);else if(!c)return m?n:new rt(n,this)}}else for(let G=0,Y,j;G<p.length;G+=2){if(Y=this.tag.get(p[G]),!Y){if(c)continue;return m?n:new rt(n,this)}if(j=(Y=Y&&Y.get(p[G+1]))&&Y.length)P++,B.push(Y);else if(!c)return m?n:new rt(n,this)}if(P){if(k=wl(k,B,e,C,m),E=k.length,!E&&!c)return m?k:new rt(k,this);P--}}if(E)r[S]=M,n.push(k),S++;else if(d.length===1)return m?n:new rt(n,this)}if(x){if(this.db&&p&&p.length&&!O)for(y=0;y<p.length;y+=2){if(r=this.index.get(p[y]),!r){if(c)continue;return m?n:new rt(n,this)}x.push(r.db.tag(p[y+1],e,C,!1))}const L=this;return Promise.all(x).then(function(k){return s&&(s.resolve=m),k.length&&(k=L.search(t,e,s,k)),k})}if(!S)return m?n:new rt(n,this);if(l&&(!y||!this.store))return n=n[0],m?n:new rt(n,this);for(x=[],C=0;C<r.length;C++){if(p=n[C],y&&p.length&&typeof p[0].doc>"u"&&(this.db?x.push(p=this.index.get(this.field[0]).db.enrich(p)):p=ke.call(this,p)),l)return m?w?Cs(t,p,this.index,l,w):p:new rt(p,this);n[C]={field:r[C],result:p}}if(y&&this.db&&x.length){const L=this;return Promise.all(x).then(function(k){for(let M=0;M<k.length;M++)n[M].result=k[M];return w&&(n=Cs(t,n,L.index,l,w)),h?Ji(n):n})}return w&&(n=Cs(t,n,this.index,l,w)),h?Ji(n):n};function Ji(t){const e=[],s=pt(),i=pt();for(let n=0,r,l,h,c,u,a,d;n<t.length;n++){r=t[n],l=r.field,h=r.result;for(let S=0;S<h.length;S++)u=h[S],typeof u!="object"?u={id:c=u}:c=u.id,(a=s[c])?a.push(l):(u.field=s[c]=[l],e.push(u)),(d=u.highlight)&&(a=i[c],a||(i[c]=a={},u.highlight=a),a[l]=d)}return e}function Sl(t,e,s,i,n){return t=this.tag.get(t),t?(t=t.get(e),t?(e=t.length-i,e>0&&((s&&e>s||i)&&(t=t.slice(i,i+s)),n&&(t=ke.call(this,t))),t):[]):[]}function ke(t){if(!this||!this.store)return t;if(this.db)return this.index.get(this.field[0]).db.enrich(t);const e=Array(t.length);for(let s=0,i;s<t.length;s++)i=t[s],e[s]={id:i,doc:this.store.get(i)};return e}function De(t){if(!this||this.constructor!==De)return new De(t);const e=t.document||t.doc||t;let s,i;if(this.B=[],this.field=[],this.D=[],this.key=(s=e.key||e.id)&&$s(s,this.D)||"id",(i=t.keystore||0)&&(this.keystore=i),this.fastupdate=!!t.fastupdate,this.reg=!this.fastupdate||t.worker||t.db?i?new Vt(i):new Set:i?new Mt(i):new Map,this.h=(s=e.store||null)&&s&&s!==!0&&[],this.store=s?i?new Mt(i):new Map:null,this.cache=(s=t.cache||null)&&new de(s),t.cache=!1,this.worker=t.worker||!1,this.priority=t.priority||4,this.index=Tl.call(this,t,e),this.tag=null,(s=e.tag)&&(typeof s=="string"&&(s=[s]),s.length)){this.tag=new Map,this.A=[],this.F=[];for(let n=0,r,l;n<s.length;n++){if(r=s[n],l=r.field||r,!l)throw Error("The tag field from the document descriptor is undefined.");r.custom?this.A[n]=r.custom:(this.A[n]=$s(l,this.D),r.filter&&(typeof this.A[n]=="string"&&(this.A[n]=new String(this.A[n])),this.A[n].G=r.filter)),this.F[n]=l,this.tag.set(l,new Map)}}if(this.worker){this.fastupdate=!1,t=[];for(const n of this.index.values())n.then&&t.push(n);if(t.length){const n=this;return Promise.all(t).then(function(r){let l=0;for(const h of n.index.entries()){const c=h[0];let u=h[1];u.then&&(u=r[l],n.index.set(c,u),l++)}return n})}}else t.db&&(this.fastupdate=!1,this.mount(t.db))}D=De.prototype;D.mount=function(t){let e=this.field;if(this.tag)for(let r=0,l;r<this.F.length;r++){l=this.F[r];var s=void 0;this.index.set(l,s=new _t({},this.reg)),e===this.field&&(e=e.slice(0)),e.push(l),s.tag=this.tag.get(l)}s=[];const i={db:t.db,type:t.type,fastupdate:t.fastupdate};for(let r=0,l,h;r<e.length;r++){i.field=h=e[r],l=this.index.get(h);const c=new t.constructor(t.id,i);c.id=t.id,s[r]=c.mount(l),l.document=!0,r?l.bypass=!0:l.store=this.store}const n=this;return this.db=Promise.all(s).then(function(){n.db=!0})};D.commit=async function(){const t=[];for(const e of this.index.values())t.push(e.commit());await Promise.all(t),this.reg.clear()};D.destroy=function(){const t=[];for(const e of this.index.values())t.push(e.destroy());return Promise.all(t)};function Tl(t,e){const s=new Map;let i=e.index||e.field||e;$t(i)&&(i=[i]);for(let r=0,l,h;r<i.length;r++){if(l=i[r],$t(l)||(h=l,l=l.field),h=He(h)?Object.assign({},t,h):t,this.worker){var n=void 0;n=(n=h.encoder)&&n.encode?n:new Je(typeof n=="string"?xn[n]:n||{}),n=new Ee(h,n),s.set(l,n)}this.worker||s.set(l,new _t(h,this.reg)),h.custom?this.B[r]=h.custom:(this.B[r]=$s(l,this.D),h.filter&&(typeof this.B[r]=="string"&&(this.B[r]=new String(this.B[r])),this.B[r].G=h.filter)),this.field[r]=l}if(this.h){t=e.store,$t(t)&&(t=[t]);for(let r=0,l,h;r<t.length;r++)l=t[r],h=l.field||l,l.custom?(this.h[r]=l.custom,l.custom.O=h):(this.h[r]=$s(h,this.D),l.filter&&(typeof this.h[r]=="string"&&(this.h[r]=new String(this.h[r])),this.h[r].G=l.filter))}return s}function $s(t,e){const s=t.split(":");let i=0;for(let n=0;n<s.length;n++)t=s[n],t[t.length-1]==="]"&&(t=t.substring(0,t.length-2))&&(e[i]=!0),t&&(s[i++]=t);return i<s.length&&(s.length=i),i>1?s:s[0]}D.append=function(t,e){return this.add(t,e,!0)};D.update=function(t,e){return this.remove(t).add(t,e)};D.remove=function(t){He(t)&&(t=We(t,this.key));for(var e of this.index.values())e.remove(t,!0);if(this.reg.has(t)){if(this.tag&&!this.fastupdate)for(let s of this.tag.values())for(let i of s){e=i[0];const n=i[1],r=n.indexOf(t);r>-1&&(n.length>1?n.splice(r,1):s.delete(e))}this.store&&this.store.delete(t),this.reg.delete(t)}return this.cache&&this.cache.remove(t),this};D.clear=function(){const t=[];for(const e of this.index.values()){const s=e.clear();s.then&&t.push(s)}if(this.tag)for(const e of this.tag.values())e.clear();return this.store&&this.store.clear(),this.cache&&this.cache.clear(),t.length?Promise.all(t):this};D.contain=function(t){return this.db?this.index.get(this.field[0]).db.has(t):this.reg.has(t)};D.cleanup=function(){for(const t of this.index.values())t.cleanup();return this};D.get=function(t){return this.db?this.index.get(this.field[0]).db.enrich(t).then(function(e){return e[0]&&e[0].doc||null}):this.store.get(t)||null};D.set=function(t,e){return typeof t=="object"&&(e=t,t=We(e,this.key)),this.store.set(t,e),this};D.searchCache=vn;D.export=vl;D.import=xl;Ln(De.prototype);function An(t,e=0){let s=[],i=[];e&&(e=25e4/e*5e3|0);for(const n of t.entries())i.push(n),i.length===e&&(s.push(i),i=[]);return i.length&&s.push(i),s}function bn(t,e){e||(e=new Map);for(let s=0,i;s<t.length;s++)i=t[s],e.set(i[0],i[1]);return e}function yr(t,e=0){let s=[],i=[];e&&(e=25e4/e*1e3|0);for(const n of t.entries())i.push([n[0],An(n[1])[0]||[]]),i.length===e&&(s.push(i),i=[]);return i.length&&s.push(i),s}function wr(t,e){e||(e=new Map);for(let s=0,i,n;s<t.length;s++)i=t[s],n=e.get(i[0]),e.set(i[0],bn(i[1],n));return e}function Sr(t){let e=[],s=[];for(const i of t.keys())s.push(i),s.length===25e4&&(e.push(s),s=[]);return s.length&&e.push(s),e}function Tr(t,e){e||(e=new Set);for(let s=0;s<t.length;s++)e.add(t[s]);return e}function Ms(t,e,s,i,n,r,l=0){const h=i&&i.constructor===Array;var c=h?i.shift():i;if(!c)return this.export(t,e,n,r+1);if((c=t((e?e+".":"")+(l+1)+"."+s,JSON.stringify(c)))&&c.then){const u=this;return c.then(function(){return Ms.call(u,t,e,s,h?i:null,n,r,l+1)})}return Ms.call(this,t,e,s,h?i:null,n,r,l+1)}function vl(t,e,s=0,i=0){if(s<this.field.length){const l=this.field[s];if((e=this.index.get(l).export(t,l,s,i=1))&&e.then){const h=this;return e.then(function(){return h.export(t,l,s+1)})}return this.export(t,l,s+1)}let n,r;switch(i){case 0:n="reg",r=Sr(this.reg),e=null;break;case 1:n="tag",r=this.tag&&yr(this.tag,this.reg.size),e=null;break;case 2:n="doc",r=this.store&&An(this.store),e=null;break;default:return}return Ms.call(this,t,e,n,r||null,s,i)}function xl(t,e){var s=t.split(".");s[s.length-1]==="json"&&s.pop();const i=s.length>2?s[0]:"";if(s=s.length>2?s[2]:s[1],this.worker&&i)return this.index.get(i).import(t);if(e){if(typeof e=="string"&&(e=JSON.parse(e)),i)return this.index.get(i).import(s,e);switch(s){case"reg":this.fastupdate=!1,this.reg=Tr(e,this.reg);for(let n=0,r;n<this.field.length;n++)r=this.index.get(this.field[n]),r.fastupdate=!1,r.reg=this.reg;if(this.worker){e=[];for(const n of this.index.values())e.push(n.import(t));return Promise.all(e)}break;case"tag":this.tag=wr(e,this.tag);break;case"doc":this.store=bn(e,this.store)}}}function Ui(t,e){let s="";for(const i of t.entries()){t=i[0];const n=i[1];let r="";for(let l=0,h;l<n.length;l++){h=n[l]||[""];let c="";for(let u=0;u<h.length;u++)c+=(c?",":"")+(e==="string"?'"'+h[u]+'"':h[u]);c="["+c+"]",r+=(r?",":"")+c}r='["'+t+'",['+r+"]]",s+=(s?",":"")+r}return s}_t.prototype.remove=function(t,e){const s=this.reg.size&&(this.fastupdate?this.reg.get(t):this.reg.has(t));if(s){if(this.fastupdate){for(let i=0,n,r;i<s.length;i++)if((n=s[i])&&(r=n.length))if(n[r-1]===t)n.pop();else{const l=n.indexOf(t);l>=0&&n.splice(l,1)}}else Ue(this.map,t),this.depth&&Ue(this.ctx,t);e||this.reg.delete(t)}return this.db&&(this.commit_task.push({del:t}),this.M&&vr(this)),this.cache&&this.cache.remove(t),this};function Ue(t,e){let s=0;var i=typeof e>"u";if(t.constructor===Array){for(let n=0,r,l,h;n<t.length;n++)if((r=t[n])&&r.length){if(i)return 1;if(l=r.indexOf(e),l>=0){if(r.length>1)return r.splice(l,1),1;if(delete t[n],s)return 1;h=1}else{if(h)return 1;s++}}}else for(let n of t.entries())i=n[0],Ue(n[1],e)?s++:t.delete(i);return s}const Ll={memory:{resolution:1},performance:{resolution:3,fastupdate:!0,context:{depth:1,resolution:1}},match:{tokenize:"forward"},score:{resolution:9,context:{depth:2,resolution:3}}};_t.prototype.add=function(t,e,s,i){if(e&&(t||t===0)){if(!i&&!s&&this.reg.has(t))return this.update(t,e);i=this.depth,e=this.encoder.encode(e,!i);const u=e.length;if(u){const a=pt(),d=pt(),S=this.resolution;for(let m=0;m<u;m++){let w=e[this.rtl?u-1-m:m];var n=w.length;if(n&&(i||!d[w])){var r=this.score?this.score(e,w,m,null,0):Ts(S,u,m),l="";switch(this.tokenize){case"tolerant":if(Ht(this,d,w,r,t,s),n>2){for(let p=1,y,C,x,B;p<n-1;p++)y=w.charAt(p),C=w.charAt(p+1),x=w.substring(0,p)+C,B=w.substring(p+2),l=x+y+B,Ht(this,d,l,r,t,s),l=x+B,Ht(this,d,l,r,t,s);Ht(this,d,w.substring(0,w.length-1),r,t,s)}break;case"full":if(n>2){for(let p=0,y;p<n;p++)for(r=n;r>p;r--){l=w.substring(p,r),y=this.rtl?n-1-p:p;var h=this.score?this.score(e,w,m,l,y):Ts(S,u,m,n,y);Ht(this,d,l,h,t,s)}break}case"bidirectional":case"reverse":if(n>1){for(h=n-1;h>0;h--){l=w[this.rtl?n-1-h:h]+l;var c=this.score?this.score(e,w,m,l,h):Ts(S,u,m,n,h);Ht(this,d,l,c,t,s)}l=""}case"forward":if(n>1){for(h=0;h<n;h++)l+=w[this.rtl?n-1-h:h],Ht(this,d,l,r,t,s);break}default:if(Ht(this,d,w,r,t,s),i&&u>1&&m<u-1)for(n=this.N,l=w,r=Math.min(i+1,this.rtl?m+1:u-m),h=1;h<r;h++){w=e[this.rtl?u-1-m-h:m+h],c=this.bidirectional&&w>l;const p=this.score?this.score(e,l,m,w,h-1):Ts(n+(u/2>n?0:1),u,m,r-1,h-1);Ht(this,a,c?l:w,p,t,s,c?w:l)}}}}this.fastupdate||this.reg.add(t)}}return this.db&&(this.commit_task.push(s?{ins:t}:{del:t}),this.M&&vr(this)),this};function Ht(t,e,s,i,n,r,l){let h,c;if(!(h=e[s])||l&&!h[l]){if(l?(e=h||(e[s]=pt()),e[l]=1,c=t.ctx,(h=c.get(l))?c=h:c.set(l,c=t.keystore?new Mt(t.keystore):new Map)):(c=t.map,e[s]=1),(h=c.get(s))?c=h:c.set(s,c=h=[]),r){for(let u=0,a;u<h.length;u++)if((a=h[u])&&a.includes(n)){if(u<=i)return;a.splice(a.indexOf(n),1),t.fastupdate&&(e=t.reg.get(n))&&e.splice(e.indexOf(a),1);break}}if(c=c[i]||(c[i]=[]),c.push(n),c.length===2**31-1){if(e=new Re(c),t.fastupdate)for(let u of t.reg.values())u.includes(c)&&(u[u.indexOf(c)]=e);h[i]=c=e}t.fastupdate&&((i=t.reg.get(n))?i.push(c):t.reg.set(n,[c]))}}function Ts(t,e,s,i,n){return s&&t>1?e+(i||0)<=t?s+(n||0):(t-1)/(e+(i||0))*(s+(n||0))+1|0:0}_t.prototype.search=function(t,e,s){if(s||(e||typeof t!="object"?typeof e=="object"&&(s=e,e=0):(s=t,t="")),s&&s.cache)return s.cache=!1,t=this.searchCache(t,e,s),s.cache=!0,t;let i=[],n,r,l,h=0,c,u,a,d,S;s&&(t=s.query||t,e=s.limit||e,h=s.offset||0,r=s.context,l=s.suggest,S=(c=s.resolve)&&s.enrich,a=s.boost,d=s.resolution,u=this.db&&s.tag),typeof c>"u"&&(c=this.resolve),r=this.depth&&r!==!1;let m=this.encoder.encode(t,!r);if(n=m.length,e=e||(c?100:0),n===1)return Yi.call(this,m[0],"",e,h,c,S,u);if(n===2&&r&&!l)return Yi.call(this,m[1],m[0],e,h,c,S,u);let w=pt(),p=0,y;if(r&&(y=m[0],p=1),d||d===0||(d=y?this.N:this.resolution),this.db){if(this.db.search&&(s=this.db.search(this,m,e,h,l,c,S,u),s!==!1))return s;const C=this;return(async function(){for(let x,B;p<n;p++){if((B=m[p])&&!w[B]){if(w[B]=1,x=await pn(C,B,y,0,0,!1,!1),x=Gi(x,i,l,d)){i=x;break}y&&(l&&x&&i.length||(y=B))}l&&y&&p===n-1&&!i.length&&(d=C.resolution,y="",p=-1,w=pt())}return Ki(i,d,e,h,l,a,c)})()}for(let C,x;p<n;p++){if((x=m[p])&&!w[x]){if(w[x]=1,C=pn(this,x,y,0,0,!1,!1),C=Gi(C,i,l,d)){i=C;break}y&&(l&&C&&i.length||(y=x))}l&&y&&p===n-1&&!i.length&&(d=this.resolution,y="",p=-1,w=pt())}return Ki(i,d,e,h,l,a,c)};function Ki(t,e,s,i,n,r,l){let h=t.length,c=t;if(h>1)c=Bs(t,e,s,i,n,r,l);else if(h===1)return l?Cn.call(null,t[0],s,i):new rt(t[0],this);return l?c:new rt(c,this)}function Yi(t,e,s,i,n,r,l){return t=pn(this,t,e,s,i,n,r,l),this.db?t.then(function(h){return n?h||[]:new rt(h,this)}):t&&t.length?n?Cn.call(this,t,s,i):new rt(t,this):n?[]:new rt([],this)}function Gi(t,e,s,i){let n=[];if(t&&t.length){if(t.length<=i){e.push(t);return}for(let r=0,l;r<i;r++)(l=t[r])&&(n[r]=l);if(n.length){e.push(n);return}}if(!s)return n}function pn(t,e,s,i,n,r,l,h){let c;return s&&(c=t.bidirectional&&e>s)&&(c=s,s=e,e=c),t.db?t.db.get(e,s,i,n,r,l,h):(t=s?(t=t.ctx.get(s))&&t.get(e):t.map.get(e),t)}function _t(t,e){if(!this||this.constructor!==_t)return new _t(t);if(t){var s=$t(t)?t:t.preset;s&&(t=Object.assign({},Ll[s],t))}else t={};s=t.context;const i=s===!0?{depth:1}:s||{},n=$t(t.encoder)?xn[t.encoder]:t.encode||t.encoder||{};this.encoder=n.encode?n:typeof n=="object"?new Je(n):{encode:n},this.resolution=t.resolution||9,this.tokenize=s=(s=t.tokenize)&&s!=="default"&&s!=="exact"&&s||"strict",this.depth=s==="strict"&&i.depth||0,this.bidirectional=i.bidirectional!==!1,this.fastupdate=!!t.fastupdate,this.score=t.score||null,(s=t.keystore||0)&&(this.keystore=s),this.map=s?new Mt(s):new Map,this.ctx=s?new Mt(s):new Map,this.reg=e||(this.fastupdate?s?new Mt(s):new Map:s?new Vt(s):new Set),this.N=i.resolution||3,this.rtl=n.rtl||t.rtl||!1,this.cache=(s=t.cache||null)&&new de(s),this.resolve=t.resolve!==!1,(s=t.db)&&(this.db=this.mount(s)),this.M=t.commit!==!1,this.commit_task=[],this.commit_timer=null,this.priority=t.priority||4}D=_t.prototype;D.mount=function(t){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),t.mount(this)};D.commit=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.commit(this)};D.destroy=function(){return this.commit_timer&&(clearTimeout(this.commit_timer),this.commit_timer=null),this.db.destroy()};function vr(t){t.commit_timer||(t.commit_timer=setTimeout(function(){t.commit_timer=null,t.db.commit(t)},1))}D.clear=function(){return this.map.clear(),this.ctx.clear(),this.reg.clear(),this.cache&&this.cache.clear(),this.db?(this.commit_timer&&clearTimeout(this.commit_timer),this.commit_timer=null,this.commit_task=[],this.db.clear()):this};D.append=function(t,e){return this.add(t,e,!0)};D.contain=function(t){return this.db?this.db.has(t):this.reg.has(t)};D.update=function(t,e){const s=this,i=this.remove(t);return i&&i.then?i.then(()=>s.add(t,e)):this.add(t,e)};D.cleanup=function(){return this.fastupdate?(Ue(this.map),this.depth&&Ue(this.ctx),this):this};D.searchCache=vn;D.export=function(t,e,s=0,i=0){let n,r;switch(i){case 0:n="reg",r=Sr(this.reg);break;case 1:n="cfg",r=null;break;case 2:n="map",r=An(this.map,this.reg.size);break;case 3:n="ctx",r=yr(this.ctx,this.reg.size);break;default:return}return Ms.call(this,t,e,n,r,s,i)};D.import=function(t,e){if(e)switch(typeof e=="string"&&(e=JSON.parse(e)),t=t.split("."),t[t.length-1]==="json"&&t.pop(),t.length===3&&t.shift(),t=t.length>1?t[1]:t[0],t){case"reg":this.fastupdate=!1,this.reg=Tr(e,this.reg);break;case"map":this.map=bn(e,this.map);break;case"ctx":this.ctx=wr(e,this.ctx)}};D.serialize=function(t=!0){let e="",s="",i="";if(this.reg.size){let r;for(var n of this.reg.keys())r||(r=typeof n),e+=(e?",":"")+(r==="string"?'"'+n+'"':n);e="index.reg=new Set(["+e+"]);",s=Ui(this.map,r),s="index.map=new Map(["+s+"]);";for(const l of this.ctx.entries()){n=l[0];let h=Ui(l[1],r);h="new Map(["+h+"])",h='["'+n+'",'+h+"]",i+=(i?",":"")+h}i="index.ctx=new Map(["+i+"]);"}return t?"function inject(index){"+e+s+i+"}":e+s+i};Ln(_t.prototype);const xr=typeof window<"u"&&(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),Vs=["map","ctx","tag","reg","cfg"],he=pt();function _s(t,e={}){if(!this||this.constructor!==_s)return new _s(t,e);typeof t=="object"&&(e=t,t=t.name),t||console.info("Default storage space was used, because a name was not passed."),this.id="flexsearch"+(t?":"+t.toLowerCase().replace(/[^a-z0-9_\-]/g,""):""),this.field=e.field?e.field.toLowerCase().replace(/[^a-z0-9_\-]/g,""):"",this.type=e.type,this.fastupdate=this.support_tag_search=!1,this.db=null,this.h={}}D=_s.prototype;D.mount=function(t){return t.index?t.mount(this):(t.db=this,this.open())};D.open=function(){if(this.db)return this.db;let t=this;navigator.storage&&navigator.storage.persist&&navigator.storage.persist(),he[t.id]||(he[t.id]=[]),he[t.id].push(t.field);const e=xr.open(t.id,1);return e.onupgradeneeded=function(){const s=t.db=this.result;for(let i=0,n;i<Vs.length;i++){n=Vs[i];for(let r=0,l;r<he[t.id].length;r++)l=he[t.id][r],s.objectStoreNames.contains(n+(n!=="reg"&&l?":"+l:""))||s.createObjectStore(n+(n!=="reg"&&l?":"+l:""))}},t.db=ie(e,function(s){t.db=s,t.db.onversionchange=function(){t.close()}})};D.close=function(){this.db&&this.db.close(),this.db=null};D.destroy=function(){const t=xr.deleteDatabase(this.id);return ie(t)};D.clear=function(){const t=[];for(let s=0,i;s<Vs.length;s++){i=Vs[s];for(let n=0,r;n<he[this.id].length;n++)r=he[this.id][n],t.push(i+(i!=="reg"&&r?":"+r:""))}const e=this.db.transaction(t,"readwrite");for(let s=0;s<t.length;s++)e.objectStore(t[s]).clear();return ie(e)};D.get=function(t,e,s=0,i=0,n=!0,r=!1){t=this.db.transaction((e?"ctx":"map")+(this.field?":"+this.field:""),"readonly").objectStore((e?"ctx":"map")+(this.field?":"+this.field:"")).get(e?e+":"+t:t);const l=this;return ie(t).then(function(h){let c=[];if(!h||!h.length)return c;if(n){if(!s&&!i&&h.length===1)return h[0];for(let u=0,a;u<h.length;u++)if((a=h[u])&&a.length){if(i>=a.length){i-=a.length;continue}const d=s?i+Math.min(a.length-i,s):a.length;for(let S=i;S<d;S++)c.push(a[S]);if(i=0,c.length===s)break}return r?l.enrich(c):c}return h})};D.tag=function(t,e=0,s=0,i=!1){t=this.db.transaction("tag"+(this.field?":"+this.field:""),"readonly").objectStore("tag"+(this.field?":"+this.field:"")).get(t);const n=this;return ie(t).then(function(r){return!r||!r.length||s>=r.length?[]:!e&&!s?r:(r=r.slice(s,s+e),i?n.enrich(r):r)})};D.enrich=function(t){typeof t!="object"&&(t=[t]);const e=this.db.transaction("reg","readonly").objectStore("reg"),s=[];for(let i=0;i<t.length;i++)s[i]=ie(e.get(t[i]));return Promise.all(s).then(function(i){for(let n=0;n<i.length;n++)i[n]={id:t[n],doc:i[n]?JSON.parse(i[n]):null};return i})};D.has=function(t){return t=this.db.transaction("reg","readonly").objectStore("reg").getKey(t),ie(t).then(function(e){return!!e})};D.search=null;D.info=function(){};D.transaction=function(t,e,s){t+=t!=="reg"&&this.field?":"+this.field:"";let i=this.h[t+":"+e];if(i)return s.call(this,i);let n=this.db.transaction(t,e);this.h[t+":"+e]=i=n.objectStore(t);const r=s.call(this,i);return this.h[t+":"+e]=null,ie(n).finally(function(){return r})};D.commit=async function(t){let e=t.commit_task,s=[];t.commit_task=[];for(let i=0,n;i<e.length;i++)n=e[i],n.del&&s.push(n.del);s.length&&await this.remove(s),t.reg.size&&(await this.transaction("map","readwrite",function(i){for(const n of t.map){const r=n[0],l=n[1];l.length&&(i.get(r).onsuccess=function(){let h=this.result;var c;if(h&&h.length){const u=Math.max(h.length,l.length);for(let a=0,d,S;a<u;a++)if((S=l[a])&&S.length){if((d=h[a])&&d.length)for(c=0;c<S.length;c++)d.push(S[c]);else h[a]=S;c=1}}else h=l,c=1;c&&i.put(h,r)})}}),await this.transaction("ctx","readwrite",function(i){for(const n of t.ctx){const r=n[0],l=n[1];for(const h of l){const c=h[0],u=h[1];u.length&&(i.get(r+":"+c).onsuccess=function(){let a=this.result;var d;if(a&&a.length){const S=Math.max(a.length,u.length);for(let m=0,w,p;m<S;m++)if((p=u[m])&&p.length){if((w=a[m])&&w.length)for(d=0;d<p.length;d++)w.push(p[d]);else a[m]=p;d=1}}else a=u,d=1;d&&i.put(a,r+":"+c)})}}}),t.store?await this.transaction("reg","readwrite",function(i){for(const n of t.store){const r=n[0],l=n[1];i.put(typeof l=="object"?JSON.stringify(l):1,r)}}):t.bypass||await this.transaction("reg","readwrite",function(i){for(const n of t.reg.keys())i.put(1,n)}),t.tag&&await this.transaction("tag","readwrite",function(i){for(const n of t.tag){const r=n[0],l=n[1];l.length&&(i.get(r).onsuccess=function(){let h=this.result;h=h&&h.length?h.concat(l):l,i.put(h,r)})}}),t.map.clear(),t.ctx.clear(),t.tag&&t.tag.clear(),t.store&&t.store.clear(),t.document||t.reg.clear())};function sn(t,e,s){const i=t.value;let n,r=0;for(let l=0,h;l<i.length;l++){if(h=s?i:i[l]){for(let c=0,u,a;c<e.length;c++)if(a=e[c],u=h.indexOf(a),u>=0)if(n=1,h.length>1)h.splice(u,1);else{i[l]=[];break}r+=h.length}if(s)break}r?n&&t.update(i):t.delete(),t.continue()}D.remove=function(t){return typeof t!="object"&&(t=[t]),Promise.all([this.transaction("map","readwrite",function(e){e.openCursor().onsuccess=function(){const s=this.result;s&&sn(s,t)}}),this.transaction("ctx","readwrite",function(e){e.openCursor().onsuccess=function(){const s=this.result;s&&sn(s,t)}}),this.transaction("tag","readwrite",function(e){e.openCursor().onsuccess=function(){const s=this.result;s&&sn(s,t,!0)}}),this.transaction("reg","readwrite",function(e){for(let s=0;s<t.length;s++)e.delete(t[s])})])};function ie(t,e){return new Promise((s,i)=>{t.onsuccess=t.oncomplete=function(){e&&e(this.result),e=null,s(this.result)},t.onerror=t.onblocked=i,t=null})}const Cl=_t,kl=xn,Al=_s;class bl{index=new Cl({encoder:kl.CJK});db=new Al("myTodoIndexDB");initialize(){this.index.mount(this.db),console.log("Initializing FlexSearch index...")}search(e){return this.index.search(e,{suggest:!0})}update(e,s){const i=U.getRow(e,s);i.syncStatus==="pending_delete"?(this.index.remove(s),console.log(`Removed todo from index: ${s}`)):this.index.contain(s)?this.index.update(s,this.buildDocument(i)):this.index.add(s,this.buildDocument(i))}buildDocument(e){return`${e.title} ${e.description}`}}const Lr=new bl,Ce="todos",Cr=["all","inbox","personal","work","shopping"],Rn={all:"全部",inbox:"收件箱",personal:"个人",work:"工作",shopping:"购物"};let Ns="all",ve=!1,Qt="";const Ae=document.getElementById("todo-list-container"),Oe=document.getElementById("types-list");function qt(){if(!Ae){console.error("List container not found");return}let t;if(ve&&Qt&&Qt.trim()!=="")try{t=Lr.search(Qt)}catch(e){console.error("Search failed:",e),t=U.getRowIds(Ce)}else t=U.getRowIds(Ce);Ns!=="all"&&(t=t.filter(e=>{const s=U.getRow(Ce,e);return s&&s.category===Ns})),Ae.innerHTML="",t.forEach(e=>{const s=U.getRow(Ce,e);if(s.syncStatus==="pending_delete")return;const i=document.createElement("div");i.className="todo-item",i.setAttribute("data-id",e),s.completed&&i.classList.add("completed");const n=Number(s.dueAt??-1),r=Number.isFinite(n)&&n>0?new Date(n).toLocaleDateString():"";i.innerHTML=`
      <input type="checkbox" class="toggle" ${s.completed?"checked":""}>
      <div class="todo-main">
        <div class="todo-header">
          <span class="title">${Ps(String(s.title||""))}</span>
          <span class="category">${Rn[String(s.category??"all")]}</span>
        </div>
        <div class="todo-body">
          <div class="description">${Ps(String(s.description||""))}</div>
          <div class="due">${r?`截止： ${r}`:""}</div>
        </div>
      </div>
      <div class="controls">
        <button class="edit">编辑</button>
        <button class="delete">×</button>
      </div>
    `,Ae.appendChild(i)})}function Rl(){const t=document.getElementById("search-input"),e=document.getElementById("search-button"),s=document.getElementById("clear-search");console.log("triggers"),e&&(t||t==="")&&(e.addEventListener("click",()=>{const i=t.value.trim();i?(ve=!0,Qt=i):(ve=!1,Qt=""),qt()}),t.addEventListener("keydown",i=>{if(i.key==="Enter"){i.preventDefault();const n=t.value.trim();n?(ve=!0,Qt=n):(ve=!1,Qt=""),qt()}})),s&&(t||t==="")&&s.addEventListener("click",()=>{t.value="",ve=!1,Qt="",qt()})}function kr(){Oe&&(Oe.innerHTML="",Cr.forEach(t=>{const e=document.createElement("li");e.className="type"+(t===Ns?" current":""),e.textContent=Rn[t],e.setAttribute("data-type",t),Oe.appendChild(e)}))}function El(){Ae&&Ae.addEventListener("click",t=>{const e=t.target,s=e.closest(".todo-item");if(!s)return;const i=s.getAttribute("data-id");if(i)if(e.matches(".toggle"))Et.toggleTodo(i);else if(e.matches(".delete"))Et.deleteTodo(i);else if(e.matches(".edit")){const n=U.getRow(Ce,i);if(!n)return;const r=c=>{const u=Number(c??-1);return!Number.isFinite(u)||u<=0?"":new Date(u).toISOString().slice(0,10)},l=Ps(String(n.title??"")),h=Ps(String(n.description??""));s.innerHTML=`
        <div class="edit-form">
          <input class="edit-title" value="${l}" />
          <textarea class="edit-description">${h}</textarea>
          <div class="edit-row">
            <input type="date" class="edit-due" value="${r(n.dueAt)}" />
            <select class="edit-category">
              ${Cr.map(c=>`<option value="${c}" ${c===(n.category||"all")?"selected":""}>${Rn[c]}</option>`).join("")}
            </select>
          </div>
          <div class="edit-actions">
            <button class="save">保存</button>
            <button class="cancel">取消</button>
          </div>
        </div>
      `}else if(e.matches(".save")){const n=e.closest(".todo-item");if(!n)return;const r=n.getAttribute("data-id");if(!r)return;const l=n.querySelector(".edit-title"),h=n.querySelector(".edit-description"),c=n.querySelector(".edit-due"),u=n.querySelector(".edit-category"),a=l?l.value.trim():"",d=h?h.value.trim():"";let S=-1;if(c&&c.value){const w=new Date(c.value);isNaN(w.getTime())||(S=w.getTime())}const m=u?u.value:"all";a&&Et.updateTodo(r,a,d,m,S)}else e.matches(".cancel")&&qt()})}function Ps(t){return(t||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function Dl(){Oe&&Oe.addEventListener("click",t=>{const e=t.target.closest("li");if(!e)return;const s=e.getAttribute("data-type");s&&(Ns=s,kr(),qt())})}function jl(){if(!Ae){console.error("Cannot initialize renderer: list container not found.");return}U.addTableListener(Ce,()=>{qt()}),El(),Dl(),Rl(),kr(),qt()}let vs=null;const Ke={locked:!1,async triggerSync(){if(!this.locked){if(this.locked=!0,!vs){console.info("Skipping sync: no auth token set (local mode)."),this.locked=!1;return}try{const t=U.getValue("lastSyncTimestamp"),e=this.getLocalChanges(),s={lastSyncTimestamp:t||new Date(0).toISOString(),changes:{creates:e.creates,updates:e.updates,deletes:e.deletes}},i=await this.sendRequest(s);await this.processResponse(i,e.pendingDeleteLocalIds),U.setValue("lastSyncTimestamp",i.newSyncTimestamp)}catch(t){console.error("Sync failed:",t)}finally{this.locked=!1}}},getLocalChanges(){const t=[],e=[],s=[],i=[],n=Gt.getSliceRowIds("todosBySyncStatus","pending_create");for(const h of n){const c=U.getRow("todos",h);t.push(this.mapToCreateDTO(c))}const r=Gt.getSliceRowIds("todosBySyncStatus","pending_update");for(const h of r){const c=U.getRow("todos",h);c.id!=null&&e.push(this.mapToUpdateDTO(c))}const l=Gt.getSliceRowIds("todosBySyncStatus","pending_delete");for(const h of l){i.push(h);const c=U.getRow("todos",h);c.id!=null&&s.push(c.id)}return{creates:t,updates:e,deletes:s,pendingDeleteLocalIds:i}},async sendRequest(t){const e=vs,s={method:"POST",headers:{"Content-Type":"application/json",...e?{Authorization:`Bearer ${e}`}:{}},body:JSON.stringify(t)},i=await fetch("/api/todos/sync",s);if(!i.ok){const n=await i.text();throw console.error("Sync request failed:",t),new Error(`Sync request failed with status ${i.status}: ${n}`)}return await i.json()},async processResponse(t,e){U.startTransaction();try{for(const s of t.serverChanges)if(s.deleted){const i=String(Gt.getSliceRowIds("todosByServerId",String(s.id)));e.push(i)}t.serverChanges=t.serverChanges.filter(s=>!s.deleted);for(const s of e)U.hasRow("todos",s)&&U.delRow("todos",s);if(t.createdMappings)for(const[s,i]of Object.entries(t.createdMappings))U.hasRow("todos",s)&&U.setPartialRow("todos",s,{id:i,syncStatus:"synced"});if(Gt.getSliceRowIds("todosBySyncStatus","pending_update").forEach(s=>{U.setCell("todos",s,"syncStatus","synced")}),t.serverChanges)for(const s of t.serverChanges.filter(i=>!i.deleted))this.mergeServerChange(s);U.finishTransaction(),(t.serverChanges.length>0||t.createdMappings.length>0)&&qt()}catch(s){console.error("Failed to process sync response:",s)}},mergeServerChange(t){const e=Gt.getSliceRowIds("todosByServerId",String(t.id)),s=e&&e.length>0?e[0]:void 0,i=s??crypto.randomUUID(),n=this.mapDtoToFrontend(t,i),r={...n,dueAt:n.dueAt??-1,createdAt:n.createdAt??Date.now(),updatedAt:n.updatedAt??Date.now()};if(s){if(t.deleted){U.delRow("todos",s);return}const l=U.getRow("todos",s),h=Number(r.updatedAt??0),c=Number(l?.updatedAt??0);if(h>c){const u={localId:s,id:Number(t.id??-1),title:String(t.title??""),description:String(t.description??""),completed:!!(t.completed??!1),category:String(t.category??"all"),dueAt:Number(this.mapStringToTimestamp(t.dueAt)??-1),createdAt:Number(this.mapStringToTimestamp(t.createdAt)??Date.now()),updatedAt:Number(this.mapStringToTimestamp(t.updatedAt)??Date.now()),syncStatus:"synced"};U.setPartialRow("todos",s,u)}}else if(!t.deleted){const l={localId:i,id:Number(t.id??-1),title:String(t.title??""),description:String(t.description??""),completed:!!(t.completed??!1),category:String(t.category??"all"),dueAt:Number(this.mapStringToTimestamp(t.dueAt)??-1),createdAt:Number(this.mapStringToTimestamp(t.createdAt)??Date.now()),updatedAt:Number(this.mapStringToTimestamp(t.updatedAt)??Date.now()),syncStatus:"synced"};U.setRow("todos",i,l)}},mapTimestampToString:t=>t==null||t<=0?null:new Date(t).toISOString(),mapStringToTimestamp:t=>{if(!t)return null;const e=new Date(t).getTime();return isNaN(e)?null:e},mapToCreateDTO(t){return{localId:t.localId,title:t.title,description:t.description,category:t.category,completed:t.completed,dueAt:this.mapTimestampToString(t.dueAt)}},mapToUpdateDTO(t){return{id:t.id,title:t.title,description:t.description,completed:t.completed,category:t.category,dueAt:this.mapTimestampToString(t.dueAt),createdAt:this.mapTimestampToString(t.createdAt),updatedAt:this.mapTimestampToString(t.updatedAt),deleted:!1}},mapDtoToFrontend(t,e){return{localId:e,id:t.id,title:t.title,description:t.description||"",completed:t.completed,category:t.category||"inbox",dueAt:this.mapStringToTimestamp(t.dueAt),createdAt:this.mapStringToTimestamp(t.createdAt),updatedAt:this.mapStringToTimestamp(t.updatedAt)}},setAuthToken(t){vs=t;try{t?localStorage.setItem("authToken",t):localStorage.removeItem("authToken")}catch(e){console.warn("Failed to persist auth token to localStorage",e)}},clearAuthToken(){vs=null;try{localStorage.removeItem("authToken")}catch{}}},Bl={async authenticate(t,e){try{const s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:e})});if(!s.ok){const n=await s.text();return console.error("Auth failed:",s.status,n),!1}const i=await s.json();return i&&i.token?(Ke.setAuthToken(String(i.token)),!0):!1}catch(s){return console.error("Auth error:",s),!1}}};let ks=null;function mn(t=1e3){Ke.triggerSync().catch(e=>console.error("Initial sync failed:",e)),En(),ks=window.setInterval(()=>{Ke.triggerSync().catch(e=>console.error("Periodic sync failed:",e))},t)}function En(){ks!==null&&(clearInterval(ks),ks=null)}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("new-todo-form"),e=document.getElementById("new-todo-title"),s=document.getElementById("new-todo-description"),i=document.getElementById("new-todo-due"),n=document.getElementById("new-todo-category");t&&e?t.addEventListener("submit",w=>{w.preventDefault();const p=e.value.trim(),y=s?s.value.trim():"",C=n?n.value:"all";let x=-1;if(i&&i.value){const B=new Date(i.value);isNaN(B.getTime())||(x=B.getTime())}p&&(Et.createTodo(p,y,C,x),e.value="",s&&(s.value=""),i&&(i.value=""),n&&(n.value="all"))}):console.error("New todo form or input not found"),jl();const r=document.getElementById("auth-overlay"),l=document.getElementById("auth-signin"),h=document.getElementById("auth-local"),c=document.getElementById("auth-username"),u=document.getElementById("auth-password"),a=document.getElementById("auth-error");function d(){r&&(r.style.display="none")}function S(){r&&(r.style.display="flex")}const m=(()=>{try{return localStorage.getItem("authToken")}catch{return null}})();m?(Ke.setAuthToken(m),d(),mn()):S(),l&&c&&u&&l.addEventListener("click",async()=>{const w=c.value.trim(),p=u.value;if(!w||!p){a&&(a.textContent="请输入用户名和密码。");return}a&&(a.textContent=""),await Bl.authenticate(w,p)?(d(),mn()):a&&(a.textContent="身份验证失败。请尝试本地模式或重试。")}),h&&h.addEventListener("click",()=>{Ke.clearAuthToken(),d()})});window.addEventListener("beforeunload",()=>En());window.startPeriodicSync=mn;window.stopPeriodicSync=En;U.addRowListener("todos",null,(t,e,s)=>Lr.update(e,s));
